import{d as Ke,f as a,e as X,A as Qe,B as et,z as j,g as u,h as t,q as Ye,j as tt,t as n,m as Z,n as x,F as K,i as Q,l as ee,k as g,D as k,E as Ie,C as be,o as r}from"./vendor-CFZyXlii.js";import{s as Te,g as st,_ as lt}from"./index-lqnnrIow.js";import{g as at}from"./userArtworkService-BWPUhC9p.js";const ot={class:"toolbar"},nt={class:"actions"},it={class:"image-container"},ut=["src"],rt={class:"control-panel"},dt={class:"artwork-info"},vt={class:"frame-styles"},ct={class:"style-options"},mt=["onClick"],gt={class:"gallery-select"},pt={class:"gallery-panel-header"},ht={class:"source-selector"},ft=["disabled"],bt={key:0,class:"gallery-grid"},wt=["onClick"],yt=["src"],xt={key:1,class:"gallery-grid"},kt=["onClick"],Ct=["src"],St={class:"artwork-title"},$t={key:2,class:"no-artwork"},_t={class:"settings-panel-body"},Wt={class:"setting-section"},Mt={class:"setting-row"},Dt={class:"slider-with-value"},Et={class:"value-display"},Ft={class:"setting-row"},Rt={class:"slider-with-value"},Ut={class:"value-display"},Yt={class:"setting-row"},It={class:"slider-with-value"},Tt={class:"value-display"},Xt={class:"setting-row"},zt={class:"ratio-options"},At=["onClick"],Vt={class:"setting-row custom-dimensions-toggle"},Bt={class:"checkbox-option"},Ot={for:"custom-dimensions-toggle"},Ht={key:0,class:"setting-row"},Nt={class:"slider-with-value"},Pt={class:"value-display"},qt={key:1,class:"setting-row"},Lt={class:"slider-with-value"},jt={class:"value-display"},Zt={key:2,class:"setting-row"},Gt={class:"current-ratio"},Jt={class:"setting-section"},Kt={class:"setting-row"},Qt={class:"setting-row"},es={class:"setting-section"},ts={class:"setting-row"},ss={class:"slider-with-value"},ls={class:"value-display"},as={class:"setting-row"},os={class:"checkbox-option"},ns={for:"shadows-toggle"},is={class:"setting-section"},us={class:"setting-row"},rs={class:"slider-with-value"},ds=["min","max"],vs={class:"value-display"},cs={class:"setting-row"},ms={class:"slider-with-value"},gs=["min","max"],ps={class:"value-display"},hs={class:"setting-row"},fs={class:"slider-with-value"},bs={class:"value-display"},ws={class:"setting-section"},ys={class:"setting-row"},xs={class:"color-options"},ks=Ke({__name:"ARFrame",setup(Cs){const we=tt(),W=a(0),B=a(0),E=a(!1),C=a(0),F=a(15),R=a(400),P=a(!0),ye=a("#f0f0e8"),q=a(1),M=a(0),D=a(0),O=a(1),U=a(50),Y=a(50),f=a(!1),b=a(30),v=a(40),z=a("#5D2A16"),A=a("#E2D1AF"),V=a("4:3"),S=a(10),$=a(1),c=a(600),m=a(450),d=a(!1),I=a(!1),Xe=X(()=>{if(!I.value)return null;const l=te();let e,s;if(d.value)e=`${c.value}px`,s=`${m.value}px`;else{const o=60*$.value;e=`calc(${o}vw - ${b.value*2}px - ${v.value*2}px)`,s=`calc((${o}vw / ${l}) - ${b.value*2}px - ${v.value*2}px)`}return{width:e,height:s,border:`${b.value}px solid ${z.value}`,padding:`${v.value}px`,"background-color":A.value,"box-shadow":P.value?`0 ${S.value}px ${S.value*1.5}px rgba(0,0,0,0.3)`:"none",transform:`perspective(1000px) translateZ(${-R.value}px) rotateX(${C.value}deg) rotateY(${F.value}deg)`,"transform-style":"preserve-3d","transform-origin":"center center",transition:"transform 0.5s ease, border 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease, width 0.3s ease, height 0.3s ease"}}),xe=l=>{const e=l.split(":");if(e.length===2){const s=parseFloat(e[0]),o=parseFloat(e[1]);if(!isNaN(s)&&!isNaN(o)&&o>0)return s/o}return 4/3},te=()=>d.value?c.value/m.value:xe(V.value),p={SYSTEM:"system",USER:"user"},_=a(p.SYSTEM),w=a([]),T=a([{id:"traditional",name:"传统红木",borderWidth:30,borderColor:"#5D2A16",matWidth:40,matColor:"#E2D1AF",shadowDepth:10,texture:"wood-texture"},{id:"modern",name:"现代简约",borderWidth:30,borderColor:"#2C2C2C",matWidth:40,matColor:"#FFFFFF",shadowDepth:10,texture:"minimal-texture"},{id:"golden",name:"描金装饰",borderWidth:30,borderColor:"#D4AF37",matWidth:40,matColor:"#F0E6D0",shadowDepth:10,texture:"gold-texture"},{id:"bamboo",name:"竹制装裱",borderWidth:30,borderColor:"#A68D6C",matWidth:40,matColor:"#EEE6D6",shadowDepth:10,texture:"bamboo-texture"},{id:"silk",name:"丝绸镶边",borderWidth:30,borderColor:"#6A5B4F",matWidth:40,matColor:"#E0D0BB",shadowDepth:10,texture:"silk-texture"}]),ze=()=>{const l={id:"custom",name:"自定义风格",borderWidth:b.value,borderColor:z.value,matWidth:v.value,matColor:A.value,shadowDepth:S.value,texture:"custom-texture",sizeScale:$.value,useCustomDimensions:d.value,customWidth:c.value,customHeight:m.value},e=T.value.findIndex(s=>s.id==="custom");e>=0?(T.value[e]=l,B.value=e):(T.value.push(l),B.value=T.value.length-1),q.value=$.value,f.value=!1,I.value=!1},Ae=X(()=>{if(_.value===p.USER&&w.value.length>0){const l=Math.min(W.value,w.value.length-1);return w.value[l].url}else return Te[W.value]}),se=X(()=>T.value[B.value]),H=X(()=>{if(_.value===p.USER&&w.value.length>0){const l=Math.min(W.value,w.value.length-1);return{title:w.value[l].title,artist:"我的作品",dynasty:"当代"}}else return st(W.value)}),Ve=X(()=>{const l=se.value,e=te();let s,o;if(d.value)s=`${c.value}px`,o=`${m.value}px`;else{const y=60*q.value;s=`calc(${y}vw - ${l.borderWidth*2}px - ${l.matWidth*2}px)`,o=`calc((${y}vw / ${e}) - ${l.borderWidth*2}px - ${l.matWidth*2}px)`}return{width:s,height:o,border:`${l.borderWidth}px solid ${l.borderColor}`,padding:`${l.matWidth}px`,"background-color":l.matColor,"box-shadow":P.value?`0 ${l.shadowDepth}px ${l.shadowDepth*1.5}px rgba(0,0,0,0.3)`:"none",transform:`perspective(1000px) translateZ(${-R.value}px) rotateX(${C.value}deg) rotateY(${F.value}deg)`,"transform-style":"preserve-3d","transform-origin":"center center",transition:"transform 0.5s ease, border 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease, width 0.3s ease, height 0.3s ease"}}),Be=X(()=>({"object-fit":"contain",width:"100%",height:"100%",transform:`translate(${M.value}px, ${D.value}px) scale(${O.value})`,transition:"transform 0.3s ease","transform-origin":"center center"})),Oe=X(()=>({"background-color":ye.value,transition:"background-color 0.5s ease"})),He=X(()=>{const l=I.value?{matWidth:v.value}:se.value;return{padding:`${Math.max(0,l.matWidth)}px`,overflow:"hidden",position:"relative"}});Qe(()=>{Ne();const l=T.value[B.value];b.value=l.borderWidth,v.value=l.matWidth,z.value=l.borderColor,A.value=l.matColor,S.value=l.shadowDepth,$.value=l.sizeScale||1,setTimeout(()=>{N()},500),window.addEventListener("resize",N)}),et(()=>{window.removeEventListener("resize",N)}),j([q,V,$],()=>{setTimeout(()=>{N()},300)});const Ne=()=>{w.value=at(),w.value.length>0&&(_.value=p.USER,W.value=0)},Pe=()=>{C.value=0,F.value=15,R.value=400},ke=l=>{_.value=l,W.value=0},Ce=l=>{W.value=l,E.value=!1,Me(),setTimeout(()=>{N()},300)},qe=l=>{const e={frameSizeScale:q.value,customSizeScale:$.value,aspectRatio:V.value,frameWidth:b.value,matWidth:v.value,shadowDepth:S.value};B.value=l;const s=T.value[l];z.value=s.borderColor,A.value=s.matColor,q.value=e.frameSizeScale,$.value=e.customSizeScale,V.value=e.aspectRatio,b.value=e.frameWidth,v.value=e.matWidth,S.value=e.shadowDepth},le=a(!1),ae=a(0),oe=a(0),Se=a(0),$e=a(0),_e=l=>{le.value=!0,"touches"in l?(ae.value=l.touches[0].clientX,oe.value=l.touches[0].clientY):(ae.value=l.clientX,oe.value=l.clientY),Se.value=C.value,$e.value=F.value},We=l=>{if(!le.value)return;let e,s;"touches"in l?(e=l.touches[0].clientX,s=l.touches[0].clientY):(e=l.clientX,s=l.clientY);const o=e-ae.value,y=s-oe.value;F.value=$e.value+o*.2,C.value=Se.value-y*.2,C.value=Math.max(-45,Math.min(45,C.value))},ne=()=>{le.value=!1},Le=l=>{l.preventDefault();const e=-Math.sign(l.deltaY)*30;R.value=Math.max(200,Math.min(800,R.value-e))},Me=()=>{M.value=0,D.value=0,O.value=1},N=()=>{const l=document.querySelector(".image-mask"),e=document.querySelector(".framed-image");if(l&&e){const s=l.clientWidth,o=l.clientHeight,y=e.clientWidth,ue=e.clientHeight,re=Math.min(y,s),de=Math.min(ue,o);U.value=Math.floor(re*.8),Y.value=Math.floor(de*.8),Math.abs(M.value)>U.value&&(M.value=M.value>0?U.value:-U.value),Math.abs(D.value)>Y.value&&(D.value=D.value>0?Y.value:-Y.value)}};j([v],()=>{setTimeout(()=>{N()},300)});const L=l=>{ye.value=l},De=()=>{we.push("/drawing")},ie=()=>{console.log("切换设置面板状态，当前状态:",f.value),f.value=!f.value,f.value?(I.value=!0,console.log("面板已打开，开始预览")):(I.value=!1,console.log("面板已关闭，停止预览"))};j([b,v,z,A,V,S],()=>{f.value&&(I.value=!0)},{deep:!0}),j([c,m,d],()=>{f.value&&(I.value=!0)},{deep:!0}),j(d,l=>{if(l){const e=te();!c.value||!m.value?(c.value=600,m.value=Math.round(600/e)):m.value=Math.round(c.value/e)}},{immediate:!0});const je=()=>{const l=document.querySelector(".frame-container"),e=document.querySelector(".image-mask"),s=document.querySelector(".framed-image");if(l&&s&&e){const o=C.value,y=F.value,ue=R.value,re=M.value,de=D.value,Ze=O.value;C.value=0,F.value=0,R.value=0,setTimeout(()=>{try{const h=document.createElement("canvas"),i=h.getContext("2d");if(!i)throw new Error("无法创建Canvas上下文");const Ee=l.getBoundingClientRect(),G=se.value;h.width=Ee.width,h.height=Ee.height,i.fillStyle=G.matColor,i.fillRect(0,0,h.width,h.height);const J=G.matWidth,ve=J,ce=J,me=h.width-J*2,ge=h.height-J*2;i.save(),i.beginPath(),i.rect(ve,ce,me,ge),i.clip();let pe=re,he=de;const Fe=Ze;pe=Math.max(-U.value,Math.min(U.value,pe)),he=Math.max(-Y.value,Math.min(Y.value,he));const Re=ve+me/2,Ue=ce+ge/2;i.save(),i.translate(Re,Ue),i.scale(Fe,Fe),i.translate(-Re,-Ue),i.drawImage(s,ve+pe,ce+he,me,ge),i.restore(),i.restore(),i.strokeStyle=G.borderColor,i.lineWidth=G.borderWidth/2,i.strokeRect(0,0,h.width,h.height);const Ge=h.toDataURL("image/png"),fe=document.createElement("a"),Je=_.value===p.USER?`装裱作品_${H.value.title}_${new Date().toISOString().slice(0,10)}.png`:`装裱作品_${H.value.title}_${H.value.artist}_${new Date().toISOString().slice(0,10)}.png`;fe.download=Je.replace(/[/\\?%*:|"<>]/g,"-"),fe.href=Ge,fe.click()}catch(h){console.error("导出图片失败:",h),alert("导出图片失败，请重试")}finally{C.value=o,F.value=y,R.value=ue}},100)}};return(l,e)=>(r(),u("div",{class:x(["frame-container-main",{"settings-open":f.value}]),style:Z(Oe.value)},[t("div",ot,[t("button",{class:"back-button",onClick:e[0]||(e[0]=s=>Ye(we).push("/interactive"))},"返回"),e[23]||(e[23]=t("h1",null,"虚拟装裱",-1)),t("div",nt,[t("button",{onClick:je},"导出作品"),t("button",{onClick:De,class:"drawing-button"},"去临摹"),t("button",{onClick:ie,class:"customize-button"},n(f.value?"关闭设置":"打开设置面板"),1)])]),t("div",{class:x(["frame-showcase",{shifted:f.value}]),onMousedown:_e,onMousemove:We,onMouseup:ne,onMouseleave:ne,onTouchstart:_e,onTouchmove:We,onTouchend:ne,onWheel:Le},[t("div",{class:"frame-container",style:Z(I.value?Xe.value:Ve.value)},[t("div",it,[t("div",{class:"image-mask",style:Z(He.value)},[t("img",{src:Ae.value,alt:"装裱作品",class:"framed-image",style:Z(Be.value)},null,12,ut)],4)])],4)],34),t("div",rt,[t("div",dt,[t("h3",null,n(H.value.title),1),t("p",null,n(H.value.artist)+" · "+n(H.value.dynasty),1)]),t("div",vt,[e[24]||(e[24]=t("h3",null,"装裱风格",-1)),t("div",ct,[(r(!0),u(K,null,Q(T.value,(s,o)=>(r(),u("div",{key:s.id,class:x(["style-option",{active:B.value===o}]),onClick:y=>qe(o)},[t("div",{class:"style-preview",style:Z({backgroundColor:s.matColor,border:`5px solid ${s.borderColor}`,padding:"5px"})},null,4),t("span",null,n(s.name),1)],10,mt))),128))])]),t("div",gt,[t("button",{onClick:e[1]||(e[1]=s=>E.value=!E.value),class:x({active:E.value})},n(E.value?"关闭图库":"选择图片"),3),E.value?(r(),u("div",{key:0,class:x(["gallery-panel",{visible:E.value}])},[t("div",pt,[e[25]||(e[25]=t("h3",null,"选择画作",-1)),t("button",{class:"gallery-close-button",onClick:e[2]||(e[2]=s=>E.value=!1)},"×")]),t("div",ht,[t("button",{onClick:e[3]||(e[3]=s=>ke(p.SYSTEM)),class:x({active:_.value===p.SYSTEM})}," 系统图库 ",2),t("button",{onClick:e[4]||(e[4]=s=>ke(p.USER)),class:x({active:_.value===p.USER}),disabled:w.value.length===0}," 我的作品 ",10,ft)]),_.value===p.SYSTEM?(r(),u("div",bt,[(r(!0),u(K,null,Q(Ye(Te).slice(0,8),(s,o)=>(r(),u("div",{key:o,class:x(["gallery-item",{active:_.value===p.SYSTEM&&W.value===o}]),onClick:y=>Ce(o)},[t("img",{src:s,alt:"作品"},null,8,yt)],10,wt))),128))])):w.value.length>0?(r(),u("div",xt,[(r(!0),u(K,null,Q(w.value,(s,o)=>(r(),u("div",{key:s.id,class:x(["gallery-item",{active:_.value===p.USER&&W.value===o}]),onClick:y=>Ce(o)},[t("img",{src:s.url,alt:"我的作品"},null,8,Ct),t("div",St,n(s.title),1)],10,kt))),128))])):(r(),u("div",$t,[e[26]||(e[26]=t("p",null,"您还没有保存任何临摹作品",-1)),t("button",{onClick:De},"去创作")]))],2)):ee("",!0)])]),t("div",{class:x(["advanced-settings-panel",{open:f.value}])},[t("div",{class:"settings-panel-header"},[e[27]||(e[27]=t("h3",null,"相框与环境设置",-1)),t("button",{class:"close-button",onClick:ie},"×")]),t("div",_t,[t("div",Wt,[e[36]||(e[36]=t("h4",null,"尺寸设置",-1)),t("div",Mt,[e[28]||(e[28]=t("label",null,"相框边宽度",-1)),t("div",Dt,[g(t("input",{type:"range","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),min:"5",max:"50",step:"1"},null,512),[[k,b.value]]),t("span",Et,n(b.value)+"px",1)])]),t("div",Ft,[e[29]||(e[29]=t("label",null,"垫板宽度",-1)),t("div",Rt,[g(t("input",{type:"range","onUpdate:modelValue":e[6]||(e[6]=s=>v.value=s),min:"10",max:"80",step:"5"},null,512),[[k,v.value]]),t("span",Ut,n(v.value)+"px",1)])]),t("div",Yt,[e[30]||(e[30]=t("label",null,"相框尺寸",-1)),t("div",It,[g(t("input",{type:"range","onUpdate:modelValue":e[7]||(e[7]=s=>$.value=s),min:"0.5",max:"1.5",step:"0.1"},null,512),[[k,$.value]]),t("span",Tt,n(Math.round($.value*100))+"%",1)])]),t("div",Xt,[e[31]||(e[31]=t("label",null,"长宽比例",-1)),t("div",zt,[(r(),u(K,null,Q(["1:1","4:3","3:2","16:9","2:3"],s=>t("button",{key:s,class:x({active:V.value===s&&!d.value}),onClick:()=>{V.value=s,d.value=!1;const o=xe(s);c.value=600,m.value=Math.round(600/o)}},n(s),11,At)),64))])]),t("div",Vt,[e[32]||(e[32]=t("label",null,"使用自定义尺寸",-1)),t("div",Bt,[g(t("input",{type:"checkbox",id:"custom-dimensions-toggle","onUpdate:modelValue":e[8]||(e[8]=s=>d.value=s)},null,512),[[Ie,d.value]]),t("label",Ot,n(d.value?"开启":"关闭"),1)])]),d.value?(r(),u("div",Ht,[e[33]||(e[33]=t("label",null,"宽度 (像素)",-1)),t("div",Nt,[g(t("input",{type:"range","onUpdate:modelValue":e[9]||(e[9]=s=>c.value=s),min:"300",max:"1200",step:"10"},null,512),[[k,c.value]]),t("span",Pt,n(c.value)+"px",1)])])):ee("",!0),d.value?(r(),u("div",qt,[e[34]||(e[34]=t("label",null,"高度 (像素)",-1)),t("div",Lt,[g(t("input",{type:"range","onUpdate:modelValue":e[10]||(e[10]=s=>m.value=s),min:"200",max:"900",step:"10"},null,512),[[k,m.value]]),t("span",jt,n(m.value)+"px",1)])])):ee("",!0),d.value?(r(),u("div",Zt,[e[35]||(e[35]=t("label",null,"当前比例",-1)),t("span",Gt,n((c.value/m.value).toFixed(2)),1)])):ee("",!0)]),t("div",Jt,[e[39]||(e[39]=t("h4",null,"颜色设置",-1)),t("div",Kt,[e[37]||(e[37]=t("label",null,"相框颜色",-1)),g(t("input",{type:"color","onUpdate:modelValue":e[11]||(e[11]=s=>z.value=s),class:"color-picker"},null,512),[[k,z.value]])]),t("div",Qt,[e[38]||(e[38]=t("label",null,"垫板颜色",-1)),g(t("input",{type:"color","onUpdate:modelValue":e[12]||(e[12]=s=>A.value=s),class:"color-picker"},null,512),[[k,A.value]])])]),t("div",es,[e[42]||(e[42]=t("h4",null,"阴影设置",-1)),t("div",ts,[e[40]||(e[40]=t("label",null,"阴影深度",-1)),t("div",ss,[g(t("input",{type:"range","onUpdate:modelValue":e[13]||(e[13]=s=>S.value=s),min:"0",max:"20",step:"1"},null,512),[[k,S.value]]),t("span",ls,n(S.value)+"px",1)])]),t("div",as,[e[41]||(e[41]=t("label",null,"显示阴影",-1)),t("div",os,[g(t("input",{type:"checkbox",id:"shadows-toggle","onUpdate:modelValue":e[14]||(e[14]=s=>P.value=s)},null,512),[[Ie,P.value]]),t("label",ns,n(P.value?"开启":"关闭"),1)])])]),t("div",is,[e[47]||(e[47]=t("h4",null,"图片位置调整",-1)),t("div",us,[e[43]||(e[43]=t("label",null,"水平位置",-1)),t("div",rs,[g(t("input",{type:"range","onUpdate:modelValue":e[15]||(e[15]=s=>M.value=s),min:-U.value,max:U.value,step:"5"},null,8,ds),[[k,M.value]]),t("span",vs,n(M.value)+"px",1)])]),t("div",cs,[e[44]||(e[44]=t("label",null,"垂直位置",-1)),t("div",ms,[g(t("input",{type:"range","onUpdate:modelValue":e[16]||(e[16]=s=>D.value=s),min:-Y.value,max:Y.value,step:"5"},null,8,gs),[[k,D.value]]),t("span",ps,n(D.value)+"px",1)])]),t("div",hs,[e[45]||(e[45]=t("label",null,"图片缩放",-1)),t("div",fs,[g(t("input",{type:"range","onUpdate:modelValue":e[17]||(e[17]=s=>O.value=s),min:"0.5",max:"3",step:"0.1"},null,512),[[k,O.value]]),t("span",bs,n(Math.round(O.value*100))+"%",1)])]),t("div",{class:"setting-row position-controls"},[t("button",{onClick:Me,class:"reset-position-button"},e[46]||(e[46]=[t("span",{class:"reset-icon"},"↺",-1),be(" 重置图片位置 ")]))])]),t("div",ws,[e[49]||(e[49]=t("h4",null,"环境设置",-1)),t("div",ys,[e[48]||(e[48]=t("label",null,"墙面颜色",-1)),t("div",xs,[t("div",{class:"color-option",style:{"background-color":"#f0f0e8"},onClick:e[18]||(e[18]=s=>L("#f0f0e8"))}),t("div",{class:"color-option",style:{"background-color":"#e6e6e6"},onClick:e[19]||(e[19]=s=>L("#e6e6e6"))}),t("div",{class:"color-option",style:{"background-color":"#f5e5d0"},onClick:e[20]||(e[20]=s=>L("#f5e5d0"))}),t("div",{class:"color-option",style:{"background-color":"#e0ebf0"},onClick:e[21]||(e[21]=s=>L("#e0ebf0"))}),t("div",{class:"color-option",style:{"background-color":"#333333"},onClick:e[22]||(e[22]=s=>L("#333333"))})])])]),t("div",{class:"setting-section"},[e[51]||(e[51]=t("h4",null,"相框位置",-1)),t("div",{class:"setting-row position-controls"},[t("button",{onClick:Pe,class:"reset-position-button"},e[50]||(e[50]=[t("span",{class:"reset-icon"},"↺",-1),be(" 重置相框位置 ")]))])])]),t("div",{class:"settings-actions"},[t("button",{onClick:ie},"取消"),t("button",{onClick:ze,class:"primary-button"},e[52]||(e[52]=[t("span",{class:"btn-icon"},"✓",-1),be(" 应用设置 ")]))])],2)],6))}}),Ws=lt(ks,[["__scopeId","data-v-8d6ed66b"]]);export{Ws as default};
