import{d as he,f as o,A as pe,B as ye,z as W,g as i,h as a,l as _,q as ke,j as be,m as I,t as $,a as j,w as G,T as O,F as J,i as K,n as P,k as T,D as z,o as u}from"./vendor-CFZyXlii.js";import{s as we}from"./userArtworkService-BWPUhC9p.js";import{_ as _e}from"./index-lqnnrIow.js";const Ce={class:"ink-lab-container"},xe={class:"toolbar"},Se={class:"toolbar-actions-container"},De={class:"toolbar-actions"},Me=["disabled"],Ie=["disabled"],$e={class:"canvas-container"},Pe={key:1,class:"canvas-hint"},Te={class:"tools-panel"},ze={class:"tools-panel-inner"},Re={key:0,class:"settings-content"},Ae={class:"setting-item"},Be={class:"setting-item"},Fe={class:"setting-item"},Ve={class:"setting-item"},Ue={key:0,class:"settings-content"},Le={class:"paper-options"},He=["onClick"],Ee={class:"presets-row"},Xe=["onClick"],Ye={key:1,class:"preset-icon"},Ne={key:0,class:"save-dialog-overlay"},qe={class:"save-dialog"},We={class:"input-group"},je={key:1,class:"save-success-toast"},Ge=20,Oe=he({__name:"InkLab",setup(Je){const U=be(),s=o(null),n=o(null),h=o(.7),v=o(10),C=o(.05),g=o("#000000"),L=o(0),H=o(0),A=o(!1),c=o([]),r=o(-1),R=o(!1),p=o(""),y=o(!1),f=o(""),k=o([]),x=o(!1),b=o(null),E=o([{id:"default",name:"标准墨色",density:.7,spread:10,evaporation:.05,color:"#000000",icon:"🖋️"},{id:"light",name:"淡墨水",density:.4,spread:15,evaporation:.08,color:"#444444",icon:"🖌️"},{id:"heavy",name:"浓墨",density:.9,spread:7,evaporation:.03,color:"#000000",icon:"✒️"},{id:"blue",name:"青墨",density:.6,spread:12,evaporation:.06,color:"#0F4C81",icon:"🔵"},{id:"red",name:"朱砂",density:.65,spread:9,evaporation:.04,color:"#B91C1C",icon:"🔴"}]),m=o(E.value[0]),X=o([{id:"rice",name:"宣纸",absorption:.8,roughness:.3},{id:"bamboo",name:"竹纸",absorption:.6,roughness:.5},{id:"silk",name:"绢本",absorption:.4,roughness:.2},{id:"rough",name:"粗纹纸",absorption:.7,roughness:.8}]),S=o(X.value[0]),w=o(!1),D=o(!1);pe(()=>{s.value&&(s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value=s.value.getContext("2d"),n.value&&(M(),B()),window.addEventListener("resize",Y))}),ye(()=>{window.removeEventListener("resize",Y),b.value!==null&&cancelAnimationFrame(b.value)});const Y=()=>{if(s.value&&n.value){const t=n.value.getImageData(0,0,s.value.width,s.value.height);s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value.putImageData(t,0,0),M()}},M=()=>{if(!n.value||!s.value)return;n.value.fillStyle="#f8f8f8",n.value.fillRect(0,0,s.value.width,s.value.height);const t=S.value.roughness;if(t>.1){n.value.save(),n.value.globalAlpha=t*.1;for(let e=0;e<s.value.width*s.value.height*.01*t;e++){const l=Math.random()*s.value.width,d=Math.random()*s.value.height,F=Math.random()*2*t;n.value.fillStyle="#00000010",n.value.beginPath(),n.value.arc(l,d,F,0,Math.PI*2),n.value.fill()}n.value.restore()}},Q=t=>{S.value=t,M()},Z=t=>{if(m.value.id===t.id){w.value=!w.value;return}h.value=t.density,v.value=t.spread,C.value=t.evaporation,g.value=t.color,m.value=t,w.value=!0,D.value=!1},N=()=>{if(!n.value||!s.value)return;const t=[];k.value.forEach(e=>{if(e.age+=1,e.density*=1-C.value,e.density<.05)return;const l=e.size+v.value*(S.value.absorption*.1)*(1-e.age*.01),d=e.speed*(1-e.age*.01),F=Math.cos(e.direction)*d,ge=Math.sin(e.direction)*d;t.push({...e,x:e.x+F,y:e.y+ge,size:l,speed:e.speed*.95});const fe=e.density*(1-e.age*.01);n.value.save(),n.value.globalAlpha=fe;const V=n.value.createRadialGradient(e.x,e.y,0,e.x,e.y,l);V.addColorStop(0,e.color),V.addColorStop(1,`${e.color}00`),n.value.fillStyle=V,n.value.beginPath(),n.value.arc(e.x,e.y,l,0,Math.PI*2),n.value.fill(),n.value.restore()}),k.value=t,t.length>0&&x.value?b.value=requestAnimationFrame(N):x.value=!1},ee=()=>{x.value=!0,N()},q=()=>{x.value=!1,b.value!==null&&(cancelAnimationFrame(b.value),b.value=null)},ae=(t,e,l=5)=>{const d={x:t,y:e,size:l,density:h.value,age:0,direction:0,speed:v.value*.05,color:g.value};k.value.push(d),x.value||ee()},B=()=>{if(n.value&&s.value){r.value<c.value.length-1&&(c.value=c.value.slice(0,r.value+1));const t=n.value.getImageData(0,0,s.value.width,s.value.height);c.value.push(t),c.value.length>Ge&&c.value.shift(),r.value=c.value.length-1}},te=()=>{r.value>0&&n.value&&s.value&&(r.value--,n.value.putImageData(c.value[r.value],0,0),k.value=[],q())},le=()=>{r.value<c.value.length-1&&n.value&&s.value&&(r.value++,n.value.putImageData(c.value[r.value],0,0))},se=()=>{U.push("/frame")},ne=t=>{if(!s.value)return;const e=s.value.getBoundingClientRect(),l=t.clientX-e.left,d=t.clientY-e.top;ae(l,d,5+v.value*.5),setTimeout(()=>{B()},1e3)},oe=t=>{if(!s.value)return;const e=s.value.getBoundingClientRect();L.value=t.clientX-e.left,H.value=t.clientY-e.top},ie=()=>{A.value=!0},ue=()=>{A.value=!1},ve=()=>{q(),k.value=[],M(),B()},ce=()=>{if(s.value){R.value=!0;const t=new Date;p.value=`水墨作品 ${t.getMonth()+1}月${t.getDate()}日`}},re=()=>{if(s.value&&p.value.trim())try{const t=s.value.toDataURL("image/png");we(p.value.trim(),t,0),y.value=!0,f.value="作品已保存！您可以在虚拟装裱中使用它。",setTimeout(()=>{y.value=!1,f.value=""},3e3),R.value=!1}catch(t){console.error("保存作品失败:",t),y.value=!1,f.value="保存失败，请重试。"}else p.value.trim()||(y.value=!1,f.value="请输入作品标题")},de=()=>{R.value=!1,p.value="",f.value=""};W([h,v,C,g],()=>{m.value&&(m.value.color=g.value)}),W(S,()=>{M()});const me=()=>{D.value=!D.value,w.value=!1};return(t,e)=>(u(),i("div",Ce,[a("div",xe,[a("button",{class:"back-button",onClick:e[0]||(e[0]=l=>ke(U).push("/interactive"))},"返回"),e[6]||(e[6]=a("h1",null,"水墨实验室",-1))]),a("div",Se,[a("div",De,[a("button",{onClick:te,title:"撤销",disabled:r.value<=0},"↩️",8,Me),a("button",{onClick:le,title:"重做",disabled:r.value>=c.value.length-1},"↪️",8,Ie),a("button",{onClick:ve,title:"清除画布"},"🗑️"),a("button",{onClick:ce,title:"保存作品"},"💾"),a("button",{onClick:se,title:"前往虚拟装裱",class:"frame-button"},"🖼️")])]),a("div",$e,[a("canvas",{ref_key:"canvasRef",ref:s,onClick:ne,onMousemove:oe,onMouseenter:ie,onMouseleave:ue,class:"ink-canvas",style:{cursor:"none"}},null,544),A.value?(u(),i("div",{key:0,class:"custom-cursor",style:I({left:`${L.value}px`,top:`${H.value}px`,width:`${Math.max(24,v.value*2)}px`,height:`${Math.max(24,v.value*2)}px`})},[m.value.id==="blue"||m.value.id==="red"?(u(),i("div",{key:0,class:"cursor-color-circle",style:I({backgroundColor:g.value,opacity:h.value*.8,transform:`scale(${v.value/10})`})},null,4)):(u(),i("span",{key:1,class:"cursor-icon",style:I({fontSize:`${Math.max(16,16+v.value*.5)}px`})},$(m.value.icon),5)),a("div",{class:"cursor-ink-dot",style:I({backgroundColor:g.value,opacity:h.value*.5,transform:`scale(${v.value/10})`})},null,4)],4)):_("",!0),k.value.length===0?(u(),i("div",Pe," 点击画布添加墨滴 ")):_("",!0)]),a("div",Te,[a("div",ze,[j(O,{name:"slide-fade"},{default:G(()=>[w.value?(u(),i("div",Re,[a("div",Ae,[e[7]||(e[7]=a("label",null,"墨水浓度",-1)),T(a("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),min:"0.1",max:"1",step:"0.05"},null,512),[[z,h.value]])]),a("div",Be,[e[8]||(e[8]=a("label",null,"扩散程度",-1)),T(a("input",{type:"range","onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l),min:"1",max:"20",step:"1"},null,512),[[z,v.value]])]),a("div",Fe,[e[9]||(e[9]=a("label",null,"蒸发速率",-1)),T(a("input",{type:"range","onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),min:"0.01",max:"0.2",step:"0.01"},null,512),[[z,C.value]])]),a("div",Ve,[e[10]||(e[10]=a("label",null,"墨色选择",-1)),T(a("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=l=>g.value=l)},null,512),[[z,g.value]])])])):_("",!0)]),_:1}),j(O,{name:"slide-fade"},{default:G(()=>[D.value?(u(),i("div",Ue,[a("div",Le,[(u(!0),i(J,null,K(X.value,l=>(u(),i("div",{key:l.id,class:P(["paper-option",{active:S.value.id===l.id}]),onClick:d=>Q(l)},[a("div",{class:P(["paper-preview",l.id])},null,2),a("span",null,$(l.name),1)],10,He))),128))])])):_("",!0)]),_:1}),a("div",Ee,[(u(!0),i(J,null,K(E.value,l=>(u(),i("div",{key:l.id,class:P(["preset-item",{active:m.value.id===l.id,"with-settings":w.value&&m.value.id===l.id}]),onClick:d=>Z(l)},[l.id==="blue"||l.id==="red"?(u(),i("div",{key:0,class:"color-circle",style:I({backgroundColor:l.color})},null,4)):(u(),i("span",Ye,$(l.icon),1))],10,Xe))),128)),a("div",{class:P(["preset-item paper-settings-btn",{active:D.value}]),onClick:me},e[11]||(e[11]=[a("span",{class:"preset-icon"},"📄",-1)]),2)])])]),R.value?(u(),i("div",Ne,[a("div",qe,[e[13]||(e[13]=a("h3",null,"保存我的作品",-1)),a("div",We,[e[12]||(e[12]=a("label",{for:"artwork-title"},"作品标题",-1)),T(a("input",{type:"text",id:"artwork-title","onUpdate:modelValue":e[5]||(e[5]=l=>p.value=l),placeholder:"请输入作品标题",maxlength:"30"},null,512),[[z,p.value]])]),a("p",{class:P(["save-message",{error:!y.value&&f.value}])},$(f.value),3),a("div",{class:"dialog-buttons"},[a("button",{onClick:de,class:"cancel-button"},"取消"),a("button",{onClick:re,class:"save-button"},"保存")])])])):_("",!0),y.value?(u(),i("div",je,[a("p",null,$(f.value),1)])):_("",!0)]))}}),ea=_e(Oe,[["__scopeId","data-v-a1f1d36f"]]);export{ea as default};
