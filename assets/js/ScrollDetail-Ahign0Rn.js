import{d as ee,f as M,z as X,A as me,B as fe,g as x,l as F,h as t,o as _,t as $,n as he,e as de,u as Pe,a as se,q as ve,j as ke}from"./vendor-BA6P5Hzh.js";import{S as $e,C as j,P as Oe,W as De,a as Le,A as Ee,D as Re,b as Se,c as xe,d as pe,M as K,G as _e,e as Ue,f as Ae,R as ze,V as Te,T as Ne,g as ge,h as ie,_ as oe,i as Q,s as z}from"./index-CqFJ73M8.js";import{O as Ye,g as h}from"./index-hv9Svz2T.js";var H=(I=>(I.LOADING="loading",I.READY="ready",I.UNROLLED="unrolled",I.ROLLED="rolled",I.ERROR="error",I))(H||{});const Ve={key:0,class:"loading-indicator"},re=.05,B=2,We=ee({__name:"ScrollViewer",props:{imageUrl:{},scale:{default:1},backgroundColor:{default:"#f5e6d3"},rodColor:{default:"#4a3728"},autoUnroll:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},emits:["imageLoaded","unrolled","rolled","error"],setup(I,{expose:N,emit:U}){const u=I,v=U,r=M(null),w=M(!1),l=M(!1),d=M(!1),y=M(H.LOADING);let a=null,c=null,b=null,o=null,m=null,p=null,P=null,C=null;const G=re*1.5,J=G,k=M(1.5);let E=!1,A=0,T={x:0,y:0};X(()=>u.imageUrl,async(e,n)=>{if(e!==n){console.log(`图片URL已更改: ${n} -> ${e}`),d.value=!0;const s=l.value;console.log(`切换图片前卷轴状态: ${s?"已展开":"已收起"}`),l.value&&(console.log("重置前收起卷轴，防止尺寸异常"),l.value=!1,p&&P&&C&&m&&(h.to(p.scale,{y:1,duration:.5,ease:"power2.inOut"}),h.to(P.position,{y:G/2,duration:.5,ease:"power2.inOut"}),h.to(C.position,{y:-.07500000000000001/2,duration:.5,ease:"power2.inOut"}),m&&h.to(m.rotation,{x:Math.PI*.1,duration:.5,ease:"power2.inOut"}))),w.value=!1,await new Promise(i=>setTimeout(i,100)),await Ce(),s&&(console.log("准备展开新卷轴，等待图片加载完成..."),await new Promise(i=>{const f=()=>{w.value?(console.log("图片已加载完成，可以展开卷轴"),i()):(console.log("图片尚未加载完成，继续等待..."),setTimeout(f,100))};f()}),console.log("开始展开新卷轴"),setTimeout(()=>{l.value?console.log("卷轴已经是展开状态，无需再次展开"):(console.log("执行卷轴展开动画"),W())},300))}},{immediate:!1}),X(()=>u.scale,e=>{console.log("卷轴缩放已变更:",e),m&&(m.scale.set(e,e,e),Y())},{immediate:!1}),X(()=>u.backgroundColor,e=>{console.log("背景颜色已变更:",e),a&&(a.background=new j(e))},{immediate:!1}),X(()=>u.rodColor,e=>{if(console.log("卷轴杆颜色已变更:",e),P&&C){const n=new ie({color:new j(e),roughness:.8,metalness:.2});P.material=n,C.material=n}},{immediate:!1});const Y=()=>{if(!m||!p||!P||!C)return;const e=B/k.value,n=q(e);h.to(m.position,{y:n,duration:.3,ease:"power1.out"}),c&&o&&h.to(o.target,{y:n,duration:.3,ease:"power1.out",onUpdate:function(){o&&o.update()}})},te=()=>{!c||!o||(u.isMobile||window.innerWidth<=768?(c.position.set(5,6.5,6),o.target.set(0,2,0)):(c.position.set(5,4.5,5),o.target.set(0,.5,0)),o.update())},Z=()=>{if(!m||!c||!o)return;const e=k.value;if(e>2){const n=Math.min(2,(e-2)*.5+.5);h.to(m.position,{y:m.position.y+n,duration:.5,ease:"power2.out"}),h.to(o.target,{y:o.target.y+n,duration:.5,ease:"power2.out",onUpdate:function(){o==null||o.update()}})}},V=async()=>{if(!r.value)return null;a=new $e,a.background=new j(u.backgroundColor);const e=r.value.clientWidth,n=r.value.clientHeight;c=new Oe(75,e/n,.1,1e3),u.isMobile||window.innerWidth<=768?c.position.set(5,6.5,6):c.position.set(5,4.5,5),c.lookAt(0,0,0),b=new De({antialias:!0}),b.setSize(e,n),b.shadowMap.enabled=!0,b.shadowMap.type=Le,r.value.appendChild(b.domElement);const s=new Ee(16777215,.5);a.add(s);const i=new Re(16777215,1);i.position.set(5,5,5),i.castShadow=!0,a.add(i),D(),o=new Ye(c,b.domElement),o.enableDamping=!0,o.dampingFactor=.05,o.enablePan=!0,o.addEventListener("change",()=>{o&&(o.target.y=Math.max(-1,o.target.y))}),u.isMobile||window.innerWidth<=768?(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2.5,o.maxDistance=15,o.target.set(0,2,0)):(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2,o.maxDistance=12,o.target.set(0,.5,0)),o.autoRotate=!1,o.autoRotateSpeed=1,o.enableZoom=!0,o.zoomSpeed=1,o.update(),c.userData.controls=o;try{console.log("初始化：开始创建卷轴"),await ue().then(()=>{console.log("初始化：卷轴创建成功"),w.value=!0,u.scale!==1&&m&&(console.log(`初始化：应用初始缩放系数 ${u.scale}`),Y()),v("imageLoaded"),u.autoUnroll&&!l.value&&(console.log("初始化：配置为自动展开，准备展开卷轴"),setTimeout(()=>{l.value?console.log("初始化：卷轴已经展开，无需再次展开"):(console.log("初始化：执行自动展开"),W())},300))})}catch(L){console.error("初始化创建卷轴失败:",L),v("error","初始化创建卷轴失败")}const f=be();r.value.addEventListener("click",ce);const O=()=>{!b||!a||!c||(requestAnimationFrame(O),o&&o.update(),b.render(a,c))};O();const g=()=>{if(!c||!b||!r.value)return;const L=r.value.clientWidth,S=r.value.clientHeight;c.aspect=L/S,c.updateProjectionMatrix(),b.setSize(L,S),window.innerWidth<=768&&c&&o&&(c.position.set(5,6.5,6),o.target.set(0,2,0))};return window.addEventListener("resize",g),()=>{window.removeEventListener("resize",g),r.value&&b&&(r.value.removeEventListener("click",ce),r.value.removeChild(b.domElement)),f&&f(),a&&a.clear(),b&&b.dispose(),a=null,c=null,b=null,o=null}},D=()=>{if(!a)return;const e=5,n=64,s=new Se(e,n),i=new xe({uniforms:{centerColor:{value:new j(13421772)},edgeColor:{value:new j(16777215)},radius:{value:e}},vertexShader:`
      varying vec2 vPosition;
      
      void main() {
        vPosition = position.xy;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 centerColor;
      uniform vec3 edgeColor;
      uniform float radius;
      
      varying vec2 vPosition;
      
      void main() {
        float dist = length(vPosition) / radius;
        float alpha = 1.0 - smoothstep(0.0, 1.0, dist);
        vec3 color = mix(edgeColor, centerColor, 1.0 - dist);
        gl_FragColor = vec4(color, alpha);
      }
    `,transparent:!0,side:pe}),f=new K(s,i);f.rotation.x=-Math.PI/2,f.receiveShadow=!0,a.add(f)},R=()=>{const e=new Ne;return new Promise((n,s)=>{if(!u.imageUrl){console.error("未提供图片URL"),v("error","未提供图片URL"),s(new Error("未提供图片URL"));return}w.value=!1,console.log(`开始加载新图片: ${u.imageUrl}`),e.load(u.imageUrl,i=>{if(console.log("图片加载成功"),w.value=!0,d.value=!1,v("imageLoaded"),i.image){const g=i.image.width,L=i.image.height,S=g/L;k.value=S,console.log(`图片尺寸: ${g}x${L}, 宽高比: ${S.toFixed(2)}`),we(S)}i.wrapS=ge,i.wrapT=ge,i.repeat.set(1,1),i.rotation=Math.PI,i.center.set(.5,.5);const f=new ie({map:i,side:pe,roughness:.7,metalness:.1}),O=new ie({color:new j(u.rodColor),roughness:.8,metalness:.2});n({paperMaterial:f,rodMaterial:O}),u.autoUnroll&&!d.value&&setTimeout(()=>{l.value||(console.log("自动展开卷轴 (初始加载)"),ye())},300)},i=>{console.log(`图片加载进度: ${Math.round(i.loaded/i.total*100)}%`)},i=>{const f=i instanceof Error?i.message:"未知错误";console.error("图片加载失败:",i),v("error",`图片加载失败: ${f}`),s(i)})})},we=e=>{let n="标准",s=.2;e<.5?(n="超宽矮图",s=.5):e<.8?(n="较宽矮图",s=.35):e>2?(n="超高窄图",s=.3):e>1.5?(n="较高窄图",s=.25):e>=.8&&e<=1.2&&(n="接近正方形",s=.2),console.log(`图片类型: ${n}, 基础安全边距: ${s.toFixed(2)}`)},ue=async()=>{if(!a)return null;const e=new _e;m=e;const n=await R(),{paperMaterial:s,rodMaterial:i}=n,f=B/k.value;let O=Math.min(f,5);k.value<.3&&(O=Math.max(O,.8),console.log(`超宽图片调整: 增加最小展开高度到 ${O.toFixed(2)}`));const g=q(f);console.log(`计算的卷轴中心位置: ${g.toFixed(2)}`);const L=new Ue(B,J,20,20);p=new K(L,s),p.rotation.z=Math.PI,p.rotation.y=Math.PI;const S=new Ae(re,re,B+.2,16);if(P=new K(S,i),P.position.y=G/2,P.rotation.z=Math.PI/2,C=new K(S.clone(),i),C.position.y=-.07500000000000001/2,C.rotation.z=Math.PI/2,e.add(p),e.add(P),e.add(C),e.position.set(0,g,0),e.rotation.x=Math.PI*.1,e.scale.set(u.scale,u.scale,u.scale),a.add(e),c&&o){if(u.isMobile||window.innerWidth<=768?o.target.set(0,g+.5,0):o.target.set(0,g,0),g>2){const ae=c.position.clone(),Me=u.isMobile||window.innerWidth<=768?4:3;c.position.set(ae.x,g+Me,ae.z),c.updateProjectionMatrix()}o.update()}return Ie(e),e},ce=e=>{if(E||!w.value||!a||!c)return;console.log("处理点击事件");const n=e.target.getBoundingClientRect(),s=(e.clientX-n.left)/n.width*2-1,i=-((e.clientY-n.top)/n.height)*2+1,f=new ze;f.setFromCamera(new Te(s,i),c),m&&f.intersectObjects(m.children,!0).length>0&&(console.log("点击到卷轴，切换展开/收起状态"),l.value?ne():W())};let W=()=>{},ne=()=>{};const ye=()=>W?(W(),!0):!1;N({unroll:W,roll:ne,resetView:()=>{if(!c||!o)return;const e=u.isMobile||window.innerWidth<=768?{x:5,y:6.5,z:6}:{x:5,y:4.5,z:5},n=u.isMobile||window.innerWidth<=768?{x:0,y:2,z:0}:{x:0,y:.5,z:0};h.to(c.position,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power2.inOut"}),h.to(o.target,{x:n.x,y:n.y,z:n.z,duration:1,ease:"power2.inOut",onUpdate:function(){o&&o.update()}})},getState:()=>({isLoaded:w.value,isUnrolled:l.value,scrollState:y.value,error:y.value===H.ERROR})}),X(w,e=>{e?y.value=H.READY:y.value=H.LOADING}),X(l,e=>{e?(y.value=H.UNROLLED,v("unrolled")):w.value&&(y.value=H.ROLLED,v("rolled"))});let le=null;me(async()=>{le=await V()}),fe(()=>{le&&le()});const Ce=async()=>{if(!(!a||!c||!r.value)){console.log("开始重置卷轴..."),m&&(a.remove(m),m=null,p=null,P=null,C=null,console.log("已移除旧卷轴"));try{console.log("开始创建新卷轴");const e=await ue();if(e){m=e,a.add(m),console.log("新卷轴已添加到场景"),te();const n=B/k.value;let s=q(n);return console.log(`计算的卷轴中心Y位置: ${s}`),m&&(m.position.y=s,console.log(`已设置卷轴位置Y: ${s}`),o&&(o.target.set(0,s,0),o.update(),console.log("已更新相机目标点")),setTimeout(Z,100)),console.log("卷轴重置完成"),!0}else return console.error("创建卷轴失败: 返回null"),!1}catch(e){return console.error("重置卷轴失败:",e),v("error",`重置卷轴失败: ${e.message||"未知错误"}`),!1}}},q=e=>{let n=Math.min(e,5);k.value<.3&&(n=Math.max(n,.8));let s=u.isMobile?3:2.2;k.value>1.5&&(s+=(k.value-1.5)*.8),k.value>2.5&&(s+=.8),k.value>3.5&&(s+=(k.value-3.5)*.4);const i=Math.max(.2,n*.15);return s+=i,s*=u.scale,s},Ie=e=>{W=()=>{if(console.log("开始展开卷轴动画..."),!p){console.error("展开失败: paperMesh不存在");return}if(!P){console.error("展开失败: topRod不存在");return}if(!C){console.error("展开失败: bottomRod不存在");return}if(l.value){console.log("卷轴已经是展开状态，无需再次展开");return}const n=B/k.value;console.log(`展开尺寸: ${n}, 宽高比: ${k.value}`);let s=Math.min(n,5);k.value<.3&&(s=Math.max(s,.8),console.log(`超宽图片调整: 最终展开高度为 ${s}`));const i=s+.1;console.log(`展开动画开始：卷轴杆距离: ${i}`),h.to(p.scale,{y:s/J,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("纸张展开动画开始"),onComplete:()=>console.log("纸张展开动画完成")}),h.to(P.position,{y:i/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("上杆移动动画开始"),onComplete:()=>console.log("上杆移动动画完成")}),h.to(C.position,{y:-i/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("下杆移动动画开始"),onComplete:()=>console.log("下杆移动动画完成")}),h.to(e.rotation,{x:0,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("卷轴旋转动画开始"),onComplete:()=>{console.log("卷轴旋转动画完成，标记为展开状态"),l.value=!0;const f=B/k.value;let O=q(f);console.log(`展开后计算的中心Y位置: ${O}`),h.to(e.position,{y:O,duration:.5,ease:"power2.out",onStart:()=>console.log("展开后位置调整开始"),onComplete:()=>{console.log("展开后位置调整完成"),Z()}}),c&&o&&h.to(o.target,{y:O,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()},onComplete:()=>console.log("相机目标点调整完成")}),u.scale!==1&&(console.log(`应用缩放系数: ${u.scale}`),Y()),v("unrolled")}})},ne=()=>{!p||!P||!C||!l.value||(h.to(p.scale,{y:1,duration:1.5,ease:"power2.inOut"}),h.to(P.position,{y:G/2,duration:1.5,ease:"power2.inOut"}),h.to(C.position,{y:-.07500000000000001/2,duration:1.5,ease:"power2.inOut"}),h.to(e.rotation,{x:Math.PI*.1,duration:1.5,ease:"power2.inOut",onComplete:()=>{l.value=!1;const n=q(J);h.to(e.position,{y:n,duration:.5,ease:"power2.out"}),c&&o&&h.to(o.target,{y:n,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()}}),u.scale!==1&&Y()}}))}},be=()=>{if(!r.value)return;const e=g=>{E=!1,A=Date.now(),T={x:g.clientX,y:g.clientY}},n=g=>{if(!E&&A>0){const L=Math.abs(g.clientX-T.x),S=Math.abs(g.clientY-T.y);(L>5||S>5)&&(E=!0)}},s=()=>{Date.now()-A<200&&!E&&(E=!1),setTimeout(()=>{A=0},10)},i=g=>{g.touches.length===1&&(E=!1,A=Date.now(),T={x:g.touches[0].clientX,y:g.touches[0].clientY})},f=g=>{if(!E&&A>0&&g.touches.length===1){const L=Math.abs(g.touches[0].clientX-T.x),S=Math.abs(g.touches[0].clientY-T.y);(L>10||S>10)&&(E=!0)}},O=()=>{Date.now()-A<300&&!E&&(E=!1),setTimeout(()=>{A=0},10)};return r.value.addEventListener("mousedown",e),r.value.addEventListener("mousemove",n),r.value.addEventListener("mouseup",s),r.value.addEventListener("touchstart",i),r.value.addEventListener("touchmove",f),r.value.addEventListener("touchend",O),()=>{r.value&&(r.value.removeEventListener("mousedown",e),r.value.removeEventListener("mousemove",n),r.value.removeEventListener("mouseup",s),r.value.removeEventListener("touchstart",i),r.value.removeEventListener("touchmove",f),r.value.removeEventListener("touchend",O))}};return(e,n)=>(_(),x("div",{ref_key:"containerRef",ref:r,class:"scroll-viewer-container"},[w.value?F("",!0):(_(),x("div",Ve,n[0]||(n[0]=[t("div",{class:"loading-spinner"},null,-1),t("div",{class:"loading-text"},"加载中...",-1)])))],512))}}),Be=oe(We,[["__scopeId","data-v-2dd3a979"]]),He={class:"scroll-control-wrapper"},Fe={class:"control-group"},Ge={class:"control-group"},Xe={class:"control-group"},je={class:"image-counter"},Je={class:"control-group"},qe=["value"],Ze={class:"color-controls"},Ke={class:"control-group color-group"},Qe=["value"],eo={class:"control-group color-group"},oo=["value"],to=ee({__name:"ScrollControlPanel",props:{isOpen:{type:Boolean},scale:{},backgroundColor:{},rodColor:{},currentImageIndex:{},totalImages:{},isMobile:{type:Boolean}},emits:["update:isOpen","update:scale","update:backgroundColor","update:rodColor","unroll","roll","prevImage","nextImage","openInfoPanel","resetView"],setup(I,{emit:N}){const U=I,u=N,v=l=>{const d=l.target;u("update:scale",Number(d.value))},r=()=>{u("update:isOpen",!U.isOpen)},w=()=>{u("openInfoPanel")};return(l,d)=>(_(),x("div",He,[t("div",{class:he(["control-panel",{open:l.isOpen}])},[t("div",{class:"panel-close-btn",onClick:r},"✕"),l.isMobile?(_(),x("div",{key:0,class:"info-panel-btn",onClick:w},"ℹ️")):F("",!0),d[10]||(d[10]=t("h3",null,"卷轴控制面板",-1)),t("div",Fe,[t("button",{onClick:d[0]||(d[0]=y=>l.$emit("unroll"))},"展开卷轴"),t("button",{onClick:d[1]||(d[1]=y=>l.$emit("roll"))},"收起卷轴")]),t("div",Ge,[t("button",{onClick:d[2]||(d[2]=y=>l.$emit("resetView")),class:"reset-view-btn"},"重置视图")]),t("div",Xe,[t("button",{onClick:d[3]||(d[3]=y=>l.$emit("prevImage"))},"上一张"),t("button",{onClick:d[4]||(d[4]=y=>l.$emit("nextImage"))},"下一张"),t("div",je,"图片 "+$(l.currentImageIndex+1)+"/"+$(l.totalImages),1)]),t("div",Je,[d[7]||(d[7]=t("label",null,"卷轴大小:",-1)),t("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:l.scale,onChange:v},null,40,qe),t("span",null,$(l.scale),1)]),t("div",Ze,[t("div",Ke,[d[8]||(d[8]=t("label",null,"背景颜色:",-1)),t("input",{type:"color",value:l.backgroundColor,onChange:d[5]||(d[5]=y=>l.$emit("update:backgroundColor",y.target.value))},null,40,Qe)]),t("div",eo,[d[9]||(d[9]=t("label",null,"卷轴杆颜色:",-1)),t("input",{type:"color",value:l.rodColor,onChange:d[6]||(d[6]=y=>l.$emit("update:rodColor",y.target.value))},null,40,oo)])])],2),t("div",{class:"control-panel-toggle",onClick:r},[t("span",null,$(l.isOpen?"✕":"⚙️"),1)])]))}}),no=oe(to,[["__scopeId","data-v-56a7609e"]]),lo={class:"basic-info-wrapper"},ao={class:"panel-header"},so={key:0,class:"info-content"},io={class:"artwork-info"},ro={class:"artwork-title"},uo={class:"artwork-creator"},co={class:"artwork-artist"},vo={class:"artwork-dynasty"},po={class:"artwork-year"},go={class:"artwork-details"},mo={class:"artwork-detail-item"},fo={class:"value"},ho={class:"artwork-detail-item"},wo={class:"value"},yo={class:"artwork-description"},Co={key:0,class:"artwork-significance"},Io={key:1,class:"mobile-nav-buttons"},bo={class:"image-counter"},Mo={key:1,class:"no-info"},Po=ee({__name:"BasicInfoPanel",props:{isOpen:{type:Boolean,default:!1},currentImageIndex:{type:Number,default:0},totalImages:{type:Number,default:0},isMobile:{type:Boolean,default:!1},isControlPanelOpen:{type:Boolean,default:!1}},emits:["update:isOpen","prevImage","nextImage","openControlPanel"],setup(I,{emit:N}){const U=I,u=N,v=de(()=>Q(U.currentImageIndex)),r=()=>{u("update:isOpen",!U.isOpen)},w=()=>{u("update:isOpen",!1)},l=()=>{u("openControlPanel")},d=de(()=>!(U.isMobile&&U.isControlPanelOpen));return(y,a)=>(_(),x("div",lo,[t("div",{class:he(["info-panel",{open:I.isOpen,mobile:I.isMobile}])},[t("div",ao,[t("div",{class:"panel-close-btn",onClick:w},"✕"),I.isMobile?(_(),x("div",{key:0,class:"control-panel-btn",onClick:l},"⚙️")):F("",!0),a[2]||(a[2]=t("h3",null,"画作基本信息",-1))]),v.value?(_(),x("div",so,[t("div",io,[t("h2",ro,$(v.value.title),1),t("div",uo,[t("span",co,$(v.value.artist),1),t("span",vo,$(v.value.dynasty),1),t("span",po,$(v.value.year),1)]),t("div",go,[t("div",mo,[a[3]||(a[3]=t("span",{class:"label"},"尺寸:",-1)),t("span",fo,$(v.value.dimensions),1)]),t("div",ho,[a[4]||(a[4]=t("span",{class:"label"},"收藏地:",-1)),t("span",wo,$(v.value.collection),1)])]),t("p",yo,$(v.value.description),1)]),v.value.significance?(_(),x("div",Co,[a[5]||(a[5]=t("h3",null,"艺术价值和历史意义",-1)),t("p",null,$(v.value.significance),1)])):F("",!0),I.isMobile?(_(),x("div",Io,[t("button",{onClick:a[0]||(a[0]=c=>y.$emit("prevImage"))},"上一张"),t("button",{onClick:a[1]||(a[1]=c=>y.$emit("nextImage"))},"下一张"),t("div",bo,"图片 "+$(I.currentImageIndex+1)+"/"+$(I.totalImages),1)])):F("",!0)])):(_(),x("div",Mo,a[6]||(a[6]=[t("p",null,"暂无图片信息",-1)])))],2),d.value?(_(),x("div",{key:0,class:"info-panel-toggle",onClick:r},a[7]||(a[7]=[t("span",null,"ℹ️",-1)]))):F("",!0)]))}}),ko=oe(Po,[["__scopeId","data-v-a30ccc68"]]),$o={class:"scroll-detail-container"},Oo=ee({__name:"ScrollDetail",setup(I){const N=Pe(),U=ke(),u=M(Number(N.params.id||0)),v=M(null),r=M(!1),w=M(""),l=M("返回画廊");me(()=>{d(),window.addEventListener("resize",d),y()}),fe(()=>{window.removeEventListener("resize",d)});const d=()=>{r.value=window.innerWidth<=768},y=()=>{const V=sessionStorage.getItem("scrollReferrer"),D=document.referrer,R=D?new URL(D).pathname:"";w.value=V||R,w.value.includes("/gallery")||V==="gallery"?l.value="返回画廊":w.value==="/"||w.value.includes("/home")||V==="home"?l.value="返回主页":w.value.includes("/masterpiece")||V==="masterpiece"?l.value="返回作品":(l.value="返回画廊",sessionStorage.setItem("scrollReferrer","gallery")),console.log("用户来源:",w.value,"按钮文本:",l.value)},a=M(!1),c=M(!0),b=M(1),o=M("#f5e6d3"),m=M("#4a3728"),p=M(Math.min(u.value,z.length-1)),P=M(z[p.value]),C=M(Q(p.value)),G=()=>{l.value==="返回主页"?U.push("/"):l.value==="返回作品"?U.go(-1):U.push("/gallery")},J=()=>{v.value&&v.value.unroll()},k=()=>{v.value&&v.value.roll()},E=()=>{console.log(`图片加载完成: ${p.value+1}/${z.length}`)},A=()=>{p.value=(p.value+1)%z.length,P.value=z[p.value],C.value=Q(p.value),history.replaceState(null,"",`/scroll/${p.value}`)},T=()=>{p.value=(p.value-1+z.length)%z.length,P.value=z[p.value],C.value=Q(p.value),history.replaceState(null,"",`/scroll/${p.value}`)},Y=()=>{c.value=!0,r.value&&(a.value=!1)},te=()=>{a.value=!0,r.value&&(c.value=!1)},Z=()=>{v.value&&v.value.resetView()};return(V,D)=>(_(),x("div",$o,[t("button",{class:"back-button",onClick:G},$(l.value),1),se(Be,{ref_key:"scrollViewerRef",ref:v,imageUrl:P.value,scale:b.value,backgroundColor:o.value,rodColor:m.value,autoUnroll:!0,isMobile:r.value,onImageLoaded:E,class:"scroll-viewer"},null,8,["imageUrl","scale","backgroundColor","rodColor","isMobile"]),c.value?F("",!0):(_(),x("div",{key:0,class:"scroll-title",onClick:Y},[t("h1",null,$(C.value.title),1),t("p",null,$(C.value.artist)+" · "+$(C.value.dynasty),1)])),se(no,{isOpen:a.value,scale:b.value,backgroundColor:o.value,rodColor:m.value,currentImageIndex:p.value,totalImages:ve(z).length,isMobile:r.value,"onUpdate:isOpen":D[0]||(D[0]=R=>a.value=R),"onUpdate:scale":D[1]||(D[1]=R=>b.value=R),"onUpdate:backgroundColor":D[2]||(D[2]=R=>o.value=R),"onUpdate:rodColor":D[3]||(D[3]=R=>m.value=R),onUnroll:J,onRoll:k,onNextImage:A,onPrevImage:T,onOpenInfoPanel:Y,onResetView:Z},null,8,["isOpen","scale","backgroundColor","rodColor","currentImageIndex","totalImages","isMobile"]),se(ko,{isOpen:c.value,currentImageIndex:p.value,totalImages:ve(z).length,isMobile:r.value,isControlPanelOpen:a.value,"onUpdate:isOpen":D[4]||(D[4]=R=>c.value=R),onPrevImage:T,onNextImage:A,onOpenControlPanel:te},null,8,["isOpen","currentImageIndex","totalImages","isMobile","isControlPanelOpen"])]))}}),xo=oe(Oo,[["__scopeId","data-v-b0c231f2"]]);export{xo as default};
