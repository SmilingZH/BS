import{d as we,r as o,g as _e,h as Ce,D as J,c as i,b as a,a as y,s as xe,u as Me,n as C,y as P,t as x,e as K,w as Q,T as Z,F as ee,f as ae,v as R,G as z,o as u}from"./vendor-DTVt_46P.js";import{s as Se}from"./userArtworkService-BWPUhC9p.js";import{_ as De}from"./index-DPFM1B2x.js";const Ie={class:"ink-lab-container"},Te={class:"toolbar"},$e={class:"toolbar-actions-container"},Pe={class:"toolbar-actions"},Re=["disabled"],ze=["disabled"],Be={class:"canvas-container"},Fe={key:1,class:"canvas-hint"},Ue={class:"tools-panel"},Ve={class:"tools-panel-inner"},Ae={key:0,class:"settings-content"},Ee={class:"setting-item"},Le={class:"setting-item"},He={class:"setting-item"},Xe={class:"setting-item"},Ye={key:0,class:"settings-content"},Ge={class:"paper-options"},Ne=["onClick"],We={class:"presets-row"},qe=["onClick"],Oe={key:1,class:"preset-icon"},je={key:0,class:"save-dialog-overlay"},Je={class:"save-dialog"},Ke={class:"input-group"},Qe={key:1,class:"save-success-toast"},Ze={key:2,class:"mobile-error-toast"},ea=20,aa=we({__name:"InkLab",setup(la){const H=Me(),s=o(null),n=o(null),h=o(.7),v=o(10),M=o(.05),g=o("#000000"),X=o(0),Y=o(0),U=o(!1),c=o([]),r=o(-1),B=o(!1),p=o(""),b=o(!1),f=o(""),k=o([]),S=o(!1),w=o(null),G=o([{id:"default",name:"标准墨色",density:.7,spread:10,evaporation:.05,color:"#000000",icon:"🖋️"},{id:"light",name:"淡墨水",density:.4,spread:15,evaporation:.08,color:"#444444",icon:"🖌️"},{id:"heavy",name:"浓墨",density:.9,spread:7,evaporation:.03,color:"#000000",icon:"✒️"},{id:"blue",name:"青墨",density:.6,spread:12,evaporation:.06,color:"#0F4C81",icon:"🔵"},{id:"red",name:"朱砂",density:.65,spread:9,evaporation:.04,color:"#B91C1C",icon:"🔴"}]),m=o(G.value[0]),N=o([{id:"rice",name:"宣纸",absorption:.8,roughness:.3},{id:"bamboo",name:"竹纸",absorption:.6,roughness:.5},{id:"silk",name:"绢本",absorption:.4,roughness:.2},{id:"rough",name:"粗纹纸",absorption:.7,roughness:.8}]),D=o(N.value[0]),_=o(!1),I=o(!1),F=o(!1),V=o(""),T=o(!1);_e(()=>{s.value&&(s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value=s.value.getContext("2d"),n.value&&($(),A()),q(),window.addEventListener("resize",W),ye())}),Ce(()=>{window.removeEventListener("resize",W),w.value!==null&&cancelAnimationFrame(w.value)});const W=()=>{if(s.value&&n.value){const l=n.value.getImageData(0,0,s.value.width,s.value.height);s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value.putImageData(l,0,0),$(),q()}},q=()=>{F.value=window.innerWidth<=768},$=()=>{if(!n.value||!s.value)return;n.value.fillStyle="#f8f8f8",n.value.fillRect(0,0,s.value.width,s.value.height);const l=D.value.roughness;if(l>.1){n.value.save(),n.value.globalAlpha=l*.1;for(let e=0;e<s.value.width*s.value.height*.01*l;e++){const t=Math.random()*s.value.width,d=Math.random()*s.value.height,E=Math.random()*2*l;n.value.fillStyle="#00000010",n.value.beginPath(),n.value.arc(t,d,E,0,Math.PI*2),n.value.fill()}n.value.restore()}},le=l=>{D.value=l,$()},te=l=>{if(m.value.id===l.id){_.value=!_.value;return}h.value=l.density,v.value=l.spread,M.value=l.evaporation,g.value=l.color,m.value=l,_.value=!0,I.value=!1},O=()=>{if(!n.value||!s.value)return;const l=[];k.value.forEach(e=>{if(e.age+=1,e.density*=1-M.value,e.density<.05)return;const t=e.size+v.value*(D.value.absorption*.1)*(1-e.age*.01),d=e.speed*(1-e.age*.01),E=Math.cos(e.direction)*d,be=Math.sin(e.direction)*d;l.push({...e,x:e.x+E,y:e.y+be,size:t,speed:e.speed*.95});const ke=e.density*(1-e.age*.01);n.value.save(),n.value.globalAlpha=ke;const L=n.value.createRadialGradient(e.x,e.y,0,e.x,e.y,t);L.addColorStop(0,e.color),L.addColorStop(1,`${e.color}00`),n.value.fillStyle=L,n.value.beginPath(),n.value.arc(e.x,e.y,t,0,Math.PI*2),n.value.fill(),n.value.restore()}),k.value=l,l.length>0&&S.value?w.value=requestAnimationFrame(O):S.value=!1},se=()=>{S.value=!0,O()},j=()=>{S.value=!1,w.value!==null&&(cancelAnimationFrame(w.value),w.value=null)},ne=(l,e,t=5)=>{const d={x:l,y:e,size:t,density:h.value,age:0,direction:0,speed:v.value*.05,color:g.value};k.value.push(d),S.value||se()},A=()=>{if(n.value&&s.value){r.value<c.value.length-1&&(c.value=c.value.slice(0,r.value+1));const l=n.value.getImageData(0,0,s.value.width,s.value.height);c.value.push(l),c.value.length>ea&&c.value.shift(),r.value=c.value.length-1}},oe=()=>{r.value>0&&n.value&&s.value&&(r.value--,n.value.putImageData(c.value[r.value],0,0),k.value=[],j())},ie=()=>{r.value<c.value.length-1&&n.value&&s.value&&(r.value++,n.value.putImageData(c.value[r.value],0,0))},ue=()=>{if(F.value){V.value="此功能手机端有BUG，待修复，您可尝试用电脑打开预览。",T.value=!0,setTimeout(()=>{T.value=!1},3e3);return}H.push("/frame")},ve=l=>{if(!s.value)return;const e=s.value.getBoundingClientRect(),t=l.clientX-e.left,d=l.clientY-e.top;ne(t,d,5+v.value*.5),setTimeout(()=>{A()},1e3)},ce=l=>{if(!s.value)return;const e=s.value.getBoundingClientRect();X.value=l.clientX-e.left,Y.value=l.clientY-e.top},re=()=>{U.value=!0},de=()=>{U.value=!1},me=()=>{j(),k.value=[],$(),A()},ge=()=>{if(s.value){B.value=!0;const l=new Date;p.value=`水墨作品 ${l.getMonth()+1}月${l.getDate()}日`}},fe=()=>{if(s.value&&p.value.trim())try{const l=s.value.toDataURL("image/png");Se(p.value.trim(),l,0),b.value=!0,f.value="作品已保存！您可以在虚拟装裱中使用它。",setTimeout(()=>{b.value=!1,f.value=""},3e3),B.value=!1}catch(l){console.error("保存作品失败:",l),b.value=!1,f.value="保存失败，请重试。"}else p.value.trim()||(b.value=!1,f.value="请输入作品标题")},he=()=>{B.value=!1,p.value="",f.value=""};J([h,v,M,g],()=>{m.value&&(m.value.color=g.value)}),J(D,()=>{$()});const pe=()=>{I.value=!I.value,_.value=!1},ye=()=>{V.value='水墨实验室正在测试中，可从"关于"页面访问。',T.value=!0,setTimeout(()=>{T.value=!1},5e3)};return(l,e)=>(u(),i("div",Ie,[a("div",Te,[a("button",{class:"back-button",onClick:e[0]||(e[0]=t=>xe(H).push("/interactive"))},"返回"),e[6]||(e[6]=a("h1",null,"水墨实验室",-1))]),a("div",$e,[a("div",Pe,[a("button",{onClick:oe,title:"撤销",disabled:r.value<=0},"↩️",8,Re),a("button",{onClick:ie,title:"重做",disabled:r.value>=c.value.length-1},"↪️",8,ze),a("button",{onClick:me,title:"清除画布"},"🗑️"),a("button",{onClick:ge,title:"保存作品"},"💾"),a("button",{onClick:ue,title:"前往虚拟装裱",class:C({"frame-button":!F.value,"frame-button-mobile-disabled":F.value})},"🖼️",2)])]),a("div",Be,[a("canvas",{ref_key:"canvasRef",ref:s,onClick:ve,onMousemove:ce,onMouseenter:re,onMouseleave:de,class:"ink-canvas",style:{cursor:"none"}},null,544),U.value?(u(),i("div",{key:0,class:"custom-cursor",style:P({left:`${X.value}px`,top:`${Y.value}px`,width:`${Math.max(24,v.value*2)}px`,height:`${Math.max(24,v.value*2)}px`})},[m.value.id==="blue"||m.value.id==="red"?(u(),i("div",{key:0,class:"cursor-color-circle",style:P({backgroundColor:g.value,opacity:h.value*.8,transform:`scale(${v.value/10})`})},null,4)):(u(),i("span",{key:1,class:"cursor-icon",style:P({fontSize:`${Math.max(16,16+v.value*.5)}px`})},x(m.value.icon),5)),a("div",{class:"cursor-ink-dot",style:P({backgroundColor:g.value,opacity:h.value*.5,transform:`scale(${v.value/10})`})},null,4)],4)):y("",!0),k.value.length===0?(u(),i("div",Fe," 点击画布添加墨滴 ")):y("",!0)]),a("div",Ue,[a("div",Ve,[K(Z,{name:"slide-fade"},{default:Q(()=>[_.value?(u(),i("div",Ae,[a("div",Ee,[e[7]||(e[7]=a("label",null,"墨水浓度",-1)),R(a("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),min:"0.1",max:"1",step:"0.05"},null,512),[[z,h.value]])]),a("div",Le,[e[8]||(e[8]=a("label",null,"扩散程度",-1)),R(a("input",{type:"range","onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),min:"1",max:"20",step:"1"},null,512),[[z,v.value]])]),a("div",He,[e[9]||(e[9]=a("label",null,"蒸发速率",-1)),R(a("input",{type:"range","onUpdate:modelValue":e[3]||(e[3]=t=>M.value=t),min:"0.01",max:"0.2",step:"0.01"},null,512),[[z,M.value]])]),a("div",Xe,[e[10]||(e[10]=a("label",null,"墨色选择",-1)),R(a("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t)},null,512),[[z,g.value]])])])):y("",!0)]),_:1}),K(Z,{name:"slide-fade"},{default:Q(()=>[I.value?(u(),i("div",Ye,[a("div",Ge,[(u(!0),i(ee,null,ae(N.value,t=>(u(),i("div",{key:t.id,class:C(["paper-option",{active:D.value.id===t.id}]),onClick:d=>le(t)},[a("div",{class:C(["paper-preview",t.id])},null,2),a("span",null,x(t.name),1)],10,Ne))),128))])])):y("",!0)]),_:1}),a("div",We,[(u(!0),i(ee,null,ae(G.value,t=>(u(),i("div",{key:t.id,class:C(["preset-item",{active:m.value.id===t.id,"with-settings":_.value&&m.value.id===t.id}]),onClick:d=>te(t)},[t.id==="blue"||t.id==="red"?(u(),i("div",{key:0,class:"color-circle",style:P({backgroundColor:t.color})},null,4)):(u(),i("span",Oe,x(t.icon),1))],10,qe))),128)),a("div",{class:C(["preset-item paper-settings-btn",{active:I.value}]),onClick:pe},e[11]||(e[11]=[a("span",{class:"preset-icon"},"📄",-1)]),2)])])]),B.value?(u(),i("div",je,[a("div",Je,[e[13]||(e[13]=a("h3",null,"保存我的作品",-1)),a("div",Ke,[e[12]||(e[12]=a("label",{for:"artwork-title"},"作品标题",-1)),R(a("input",{type:"text",id:"artwork-title","onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),placeholder:"请输入作品标题",maxlength:"30"},null,512),[[z,p.value]])]),a("p",{class:C(["save-message",{error:!b.value&&f.value}])},x(f.value),3),a("div",{class:"dialog-buttons"},[a("button",{onClick:he,class:"cancel-button"},"取消"),a("button",{onClick:fe,class:"save-button"},"保存")])])])):y("",!0),b.value?(u(),i("div",Qe,[a("p",null,x(f.value),1)])):y("",!0),T.value?(u(),i("div",Ze,[a("p",null,x(V.value),1)])):y("",!0)]))}}),oa=De(aa,[["__scopeId","data-v-c2051d86"]]);export{oa as default};
