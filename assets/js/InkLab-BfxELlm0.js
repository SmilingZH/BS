import{d as be,f as o,g as we,C as _e,B as J,i,j as a,k as y,x as Ce,m as xe,n as C,q as $,t as x,a as K,w as Q,T as Z,F as ee,l as ae,p as P,E as R,o as u}from"./vendor-1Pylr8mE.js";import{s as Me}from"./userArtworkService-BWPUhC9p.js";import{_ as Se}from"./index-OhZk9ZkP.js";const De={class:"ink-lab-container"},Ie={class:"toolbar"},Te={class:"toolbar-actions-container"},$e={class:"toolbar-actions"},Pe=["disabled"],Re=["disabled"],ze={class:"canvas-container"},Be={key:1,class:"canvas-hint"},Fe={class:"tools-panel"},Ue={class:"tools-panel-inner"},Ve={key:0,class:"settings-content"},Ae={class:"setting-item"},Ee={class:"setting-item"},Le={class:"setting-item"},He={class:"setting-item"},Xe={key:0,class:"settings-content"},Ye={class:"paper-options"},Ne=["onClick"],We={class:"presets-row"},qe=["onClick"],Ge={key:1,class:"preset-icon"},je={key:0,class:"save-dialog-overlay"},Oe={class:"save-dialog"},Je={class:"input-group"},Ke={key:1,class:"save-success-toast"},Qe={key:2,class:"mobile-error-toast"},Ze=20,ea=be({__name:"InkLab",setup(aa){const L=xe(),s=o(null),n=o(null),h=o(.7),v=o(10),M=o(.05),g=o("#000000"),H=o(0),X=o(0),F=o(!1),c=o([]),r=o(-1),z=o(!1),p=o(""),k=o(!1),f=o(""),b=o([]),S=o(!1),w=o(null),Y=o([{id:"default",name:"标准墨色",density:.7,spread:10,evaporation:.05,color:"#000000",icon:"🖋️"},{id:"light",name:"淡墨水",density:.4,spread:15,evaporation:.08,color:"#444444",icon:"🖌️"},{id:"heavy",name:"浓墨",density:.9,spread:7,evaporation:.03,color:"#000000",icon:"✒️"},{id:"blue",name:"青墨",density:.6,spread:12,evaporation:.06,color:"#0F4C81",icon:"🔵"},{id:"red",name:"朱砂",density:.65,spread:9,evaporation:.04,color:"#B91C1C",icon:"🔴"}]),m=o(Y.value[0]),N=o([{id:"rice",name:"宣纸",absorption:.8,roughness:.3},{id:"bamboo",name:"竹纸",absorption:.6,roughness:.5},{id:"silk",name:"绢本",absorption:.4,roughness:.2},{id:"rough",name:"粗纹纸",absorption:.7,roughness:.8}]),D=o(N.value[0]),_=o(!1),I=o(!1),B=o(!1),W=o(""),U=o(!1);we(()=>{s.value&&(s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value=s.value.getContext("2d"),n.value&&(T(),V()),G(),window.addEventListener("resize",q))}),_e(()=>{window.removeEventListener("resize",q),w.value!==null&&cancelAnimationFrame(w.value)});const q=()=>{if(s.value&&n.value){const l=n.value.getImageData(0,0,s.value.width,s.value.height);s.value.width=window.innerWidth,s.value.height=window.innerHeight-120,n.value.putImageData(l,0,0),T(),G()}},G=()=>{B.value=window.innerWidth<=768},T=()=>{if(!n.value||!s.value)return;n.value.fillStyle="#f8f8f8",n.value.fillRect(0,0,s.value.width,s.value.height);const l=D.value.roughness;if(l>.1){n.value.save(),n.value.globalAlpha=l*.1;for(let e=0;e<s.value.width*s.value.height*.01*l;e++){const t=Math.random()*s.value.width,d=Math.random()*s.value.height,A=Math.random()*2*l;n.value.fillStyle="#00000010",n.value.beginPath(),n.value.arc(t,d,A,0,Math.PI*2),n.value.fill()}n.value.restore()}},le=l=>{D.value=l,T()},te=l=>{if(m.value.id===l.id){_.value=!_.value;return}h.value=l.density,v.value=l.spread,M.value=l.evaporation,g.value=l.color,m.value=l,_.value=!0,I.value=!1},j=()=>{if(!n.value||!s.value)return;const l=[];b.value.forEach(e=>{if(e.age+=1,e.density*=1-M.value,e.density<.05)return;const t=e.size+v.value*(D.value.absorption*.1)*(1-e.age*.01),d=e.speed*(1-e.age*.01),A=Math.cos(e.direction)*d,ye=Math.sin(e.direction)*d;l.push({...e,x:e.x+A,y:e.y+ye,size:t,speed:e.speed*.95});const ke=e.density*(1-e.age*.01);n.value.save(),n.value.globalAlpha=ke;const E=n.value.createRadialGradient(e.x,e.y,0,e.x,e.y,t);E.addColorStop(0,e.color),E.addColorStop(1,`${e.color}00`),n.value.fillStyle=E,n.value.beginPath(),n.value.arc(e.x,e.y,t,0,Math.PI*2),n.value.fill(),n.value.restore()}),b.value=l,l.length>0&&S.value?w.value=requestAnimationFrame(j):S.value=!1},se=()=>{S.value=!0,j()},O=()=>{S.value=!1,w.value!==null&&(cancelAnimationFrame(w.value),w.value=null)},ne=(l,e,t=5)=>{const d={x:l,y:e,size:t,density:h.value,age:0,direction:0,speed:v.value*.05,color:g.value};b.value.push(d),S.value||se()},V=()=>{if(n.value&&s.value){r.value<c.value.length-1&&(c.value=c.value.slice(0,r.value+1));const l=n.value.getImageData(0,0,s.value.width,s.value.height);c.value.push(l),c.value.length>Ze&&c.value.shift(),r.value=c.value.length-1}},oe=()=>{r.value>0&&n.value&&s.value&&(r.value--,n.value.putImageData(c.value[r.value],0,0),b.value=[],O())},ie=()=>{r.value<c.value.length-1&&n.value&&s.value&&(r.value++,n.value.putImageData(c.value[r.value],0,0))},ue=()=>{if(B.value){W.value="此功能手机端有BUG，待修复，您可尝试用电脑打开预览。",U.value=!0,setTimeout(()=>{U.value=!1},3e3);return}L.push("/frame")},ve=l=>{if(!s.value)return;const e=s.value.getBoundingClientRect(),t=l.clientX-e.left,d=l.clientY-e.top;ne(t,d,5+v.value*.5),setTimeout(()=>{V()},1e3)},ce=l=>{if(!s.value)return;const e=s.value.getBoundingClientRect();H.value=l.clientX-e.left,X.value=l.clientY-e.top},re=()=>{F.value=!0},de=()=>{F.value=!1},me=()=>{O(),b.value=[],T(),V()},ge=()=>{if(s.value){z.value=!0;const l=new Date;p.value=`水墨作品 ${l.getMonth()+1}月${l.getDate()}日`}},fe=()=>{if(s.value&&p.value.trim())try{const l=s.value.toDataURL("image/png");Me(p.value.trim(),l,0),k.value=!0,f.value="作品已保存！您可以在虚拟装裱中使用它。",setTimeout(()=>{k.value=!1,f.value=""},3e3),z.value=!1}catch(l){console.error("保存作品失败:",l),k.value=!1,f.value="保存失败，请重试。"}else p.value.trim()||(k.value=!1,f.value="请输入作品标题")},he=()=>{z.value=!1,p.value="",f.value=""};J([h,v,M,g],()=>{m.value&&(m.value.color=g.value)}),J(D,()=>{T()});const pe=()=>{I.value=!I.value,_.value=!1};return(l,e)=>(u(),i("div",De,[a("div",Ie,[a("button",{class:"back-button",onClick:e[0]||(e[0]=t=>Ce(L).push("/interactive"))},"返回"),e[6]||(e[6]=a("h1",null,"水墨实验室",-1))]),a("div",Te,[a("div",$e,[a("button",{onClick:oe,title:"撤销",disabled:r.value<=0},"↩️",8,Pe),a("button",{onClick:ie,title:"重做",disabled:r.value>=c.value.length-1},"↪️",8,Re),a("button",{onClick:me,title:"清除画布"},"🗑️"),a("button",{onClick:ge,title:"保存作品"},"💾"),a("button",{onClick:ue,title:"前往虚拟装裱",class:C({"frame-button":!B.value,"frame-button-mobile-disabled":B.value})},"🖼️",2)])]),a("div",ze,[a("canvas",{ref_key:"canvasRef",ref:s,onClick:ve,onMousemove:ce,onMouseenter:re,onMouseleave:de,class:"ink-canvas",style:{cursor:"none"}},null,544),F.value?(u(),i("div",{key:0,class:"custom-cursor",style:$({left:`${H.value}px`,top:`${X.value}px`,width:`${Math.max(24,v.value*2)}px`,height:`${Math.max(24,v.value*2)}px`})},[m.value.id==="blue"||m.value.id==="red"?(u(),i("div",{key:0,class:"cursor-color-circle",style:$({backgroundColor:g.value,opacity:h.value*.8,transform:`scale(${v.value/10})`})},null,4)):(u(),i("span",{key:1,class:"cursor-icon",style:$({fontSize:`${Math.max(16,16+v.value*.5)}px`})},x(m.value.icon),5)),a("div",{class:"cursor-ink-dot",style:$({backgroundColor:g.value,opacity:h.value*.5,transform:`scale(${v.value/10})`})},null,4)],4)):y("",!0),b.value.length===0?(u(),i("div",Be," 点击画布添加墨滴 ")):y("",!0)]),a("div",Fe,[a("div",Ue,[K(Z,{name:"slide-fade"},{default:Q(()=>[_.value?(u(),i("div",Ve,[a("div",Ae,[e[7]||(e[7]=a("label",null,"墨水浓度",-1)),P(a("input",{type:"range","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),min:"0.1",max:"1",step:"0.05"},null,512),[[R,h.value]])]),a("div",Ee,[e[8]||(e[8]=a("label",null,"扩散程度",-1)),P(a("input",{type:"range","onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),min:"1",max:"20",step:"1"},null,512),[[R,v.value]])]),a("div",Le,[e[9]||(e[9]=a("label",null,"蒸发速率",-1)),P(a("input",{type:"range","onUpdate:modelValue":e[3]||(e[3]=t=>M.value=t),min:"0.01",max:"0.2",step:"0.01"},null,512),[[R,M.value]])]),a("div",He,[e[10]||(e[10]=a("label",null,"墨色选择",-1)),P(a("input",{type:"color","onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t)},null,512),[[R,g.value]])])])):y("",!0)]),_:1}),K(Z,{name:"slide-fade"},{default:Q(()=>[I.value?(u(),i("div",Xe,[a("div",Ye,[(u(!0),i(ee,null,ae(N.value,t=>(u(),i("div",{key:t.id,class:C(["paper-option",{active:D.value.id===t.id}]),onClick:d=>le(t)},[a("div",{class:C(["paper-preview",t.id])},null,2),a("span",null,x(t.name),1)],10,Ne))),128))])])):y("",!0)]),_:1}),a("div",We,[(u(!0),i(ee,null,ae(Y.value,t=>(u(),i("div",{key:t.id,class:C(["preset-item",{active:m.value.id===t.id,"with-settings":_.value&&m.value.id===t.id}]),onClick:d=>te(t)},[t.id==="blue"||t.id==="red"?(u(),i("div",{key:0,class:"color-circle",style:$({backgroundColor:t.color})},null,4)):(u(),i("span",Ge,x(t.icon),1))],10,qe))),128)),a("div",{class:C(["preset-item paper-settings-btn",{active:I.value}]),onClick:pe},e[11]||(e[11]=[a("span",{class:"preset-icon"},"📄",-1)]),2)])])]),z.value?(u(),i("div",je,[a("div",Oe,[e[13]||(e[13]=a("h3",null,"保存我的作品",-1)),a("div",Je,[e[12]||(e[12]=a("label",{for:"artwork-title"},"作品标题",-1)),P(a("input",{type:"text",id:"artwork-title","onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),placeholder:"请输入作品标题",maxlength:"30"},null,512),[[R,p.value]])]),a("p",{class:C(["save-message",{error:!k.value&&f.value}])},x(f.value),3),a("div",{class:"dialog-buttons"},[a("button",{onClick:he,class:"cancel-button"},"取消"),a("button",{onClick:fe,class:"save-button"},"保存")])])])):y("",!0),k.value?(u(),i("div",Ke,[a("p",null,x(f.value),1)])):y("",!0),U.value?(u(),i("div",Qe,[a("p",null,x(W.value),1)])):y("",!0)]))}}),na=Se(ea,[["__scopeId","data-v-fcef29ce"]]);export{na as default};
