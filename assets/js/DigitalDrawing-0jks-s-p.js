import{d as oe,r as o,g as ue,h as ne,D as ie,c,b as t,a as C,s as ve,u as re,y as D,t as F,e as ce,w as de,T as he,n as T,F as pe,f as ge,v as R,G as I,o as d}from"./vendor-DTVt_46P.js";import{s as fe}from"./userArtworkService-BWPUhC9p.js";import{_ as me}from"./index-DPFM1B2x.js";const be={class:"digital-drawing-container"},we={class:"drawing-toolbar"},ye={class:"toolbar-actions-container"},_e={class:"toolbar-actions"},ke=["disabled"],Ce=["disabled"],Fe={class:"drawing-area"},xe={class:"tools-panel"},De={class:"tools-panel-inner"},Me={key:0,class:"brush-settings"},Se={class:"setting-item"},ze={class:"setting-item"},Pe=["onClick","title"],Te={class:"tool-icon"},Re={key:0,class:"save-dialog-overlay"},Ie={class:"save-dialog"},$e={class:"input-group"},Be={key:1,class:"save-success-toast"},Ee={key:2,class:"mobile-error-toast"},Ve=20,Xe=oe({__name:"DigitalDrawing",setup(Ae){const $=re(),l=o(null),e=o(null),h=o(!1),n=o(5),g=o(.8),m=o("#000000"),A=o(!0),b=o(0),w=o(0),H=o(!0),M=o(!1),x=o(!1),f=o(""),y=o(!1),p=o(""),i=o([]),v=o(-1),U=o(!1),_=o({x:0,y:0}),k=o(!1),B=o([{id:"brush-pen",name:"毛笔",icon:"🖌️",size:8,opacity:.8,color:"#000000"},{id:"ink-pen",name:"钢笔",icon:"✒️",size:2,opacity:1,color:"#000000"},{id:"water-brush",name:"水彩",icon:"💧",size:15,opacity:.4,color:"#4285F4"},{id:"charcoal",name:"炭笔",icon:"✏️",size:6,opacity:.7,color:"#666666"},{id:"eraser",name:"橡皮擦",icon:"🧽",size:15,opacity:1,color:"#FFFFFF"}]),r=o(B.value[0]),W=o(""),Y=o(!1);ue(()=>{if(l.value){const a=l.value.parentElement;a&&(l.value.width=a.clientWidth,l.value.height=a.clientHeight),e.value=l.value.getContext("2d",{willReadFrequently:!0}),e.value&&J(),V(),window.addEventListener("resize",E)}}),ne(()=>{window.removeEventListener("resize",E)});const E=()=>{if(l.value&&e.value){const a=l.value.parentElement;if(a){const s=e.value.getImageData(0,0,l.value.width,l.value.height);l.value.width=a.clientWidth,l.value.height=a.clientHeight,e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),e.value.putImageData(s,0,0),V()}}},V=()=>{U.value=window.innerWidth<=768},L=()=>{e.value&&(e.value.lineCap="round",e.value.lineJoin="round",r.value.id==="eraser"?(e.value.globalCompositeOperation="destination-out",e.value.lineWidth=n.value,e.value.globalAlpha=1):(e.value.globalCompositeOperation="source-over",e.value.strokeStyle=m.value,e.value.lineWidth=n.value,e.value.globalAlpha=g.value))},O=a=>{const s=r.value.id===a.id;r.value=a,n.value=a.size,g.value=a.opacity,m.value=a.color,s?k.value=!k.value:k.value=!0},S=()=>{if(e.value&&l.value){v.value<i.value.length-1&&(i.value=i.value.slice(0,v.value+1));const a=e.value.getImageData(0,0,l.value.width,l.value.height);i.value.push(a),i.value.length>Ve&&i.value.shift(),v.value=i.value.length-1}},N=()=>{v.value>0&&e.value&&l.value&&(v.value--,e.value.putImageData(i.value[v.value],0,0))},q=()=>{v.value<i.value.length-1&&e.value&&l.value&&(v.value++,e.value.putImageData(i.value[v.value],0,0))},G=()=>{e.value&&l.value&&(e.value.save(),e.value.globalCompositeOperation="source-over",e.value.globalAlpha=1,e.value.clearRect(0,0,l.value.width,l.value.height),e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),e.value.restore(),S())},J=()=>{e.value&&l.value&&(e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),S())},j=()=>{if(l.value){x.value=!0;const a=new Date;f.value=`我的作品 ${a.getMonth()+1}月${a.getDate()}日`}},K=()=>{if(l.value&&f.value.trim())try{const a=l.value.toDataURL("image/png");fe(f.value.trim(),a,0),y.value=!0,p.value="作品已保存！您可以在虚拟装裱中使用它。",setTimeout(()=>{y.value=!1,p.value=""},3e3),x.value=!1}catch(a){console.error("保存作品失败:",a),y.value=!1,p.value="保存失败，请重试。"}else f.value.trim()||(y.value=!1,p.value="请输入作品标题")},Q=()=>{x.value=!1,f.value="",p.value=""},Z=()=>{$.push("/frame")},ee=a=>{h.value=!0,l.value&&"setPointerCapture"in l.value&&l.value.setPointerCapture(a.pointerId),a.preventDefault(),P(a),_.value={x:b.value,y:w.value},e.value&&(e.value.beginPath(),e.value.moveTo(b.value,w.value))},z=a=>{h.value&&(h.value=!1,l.value&&"releasePointerCapture"in l.value&&l.value.releasePointerCapture(a.pointerId),e.value&&(e.value.beginPath(),S()))},P=a=>{if(!l.value)return;const s=l.value.getBoundingClientRect();"touches"in a&&a.touches.length>0?(b.value=a.touches[0].clientX-s.left,w.value=a.touches[0].clientY-s.top):"clientX"in a&&(b.value=a.clientX-s.left,w.value=a.clientY-s.top)},ae=()=>{M.value=!0},le=()=>{h.value||(M.value=!1)},te=a=>{if(!h.value||!e.value||!l.value)return;a.preventDefault(),P(a);const s=b.value,u=w.value;if(L(),A.value&&"pressure"in a&&a.pressure!==0&&(e.value.lineWidth=n.value*(.5+a.pressure*1.5)),e.value){e.value.beginPath(),e.value.moveTo(_.value.x,_.value.y);const X=(_.value.x+s)/2,se=(_.value.y+u)/2;e.value.quadraticCurveTo(X,se,s,u),e.value.stroke(),_.value={x:s,y:u}}};return ie([n,m,g],()=>{r.value&&(r.value.size=n.value,r.value.opacity=g.value,r.value.color=m.value)}),(a,s)=>(d(),c("div",be,[t("div",we,[t("button",{class:"back-button",onClick:s[0]||(s[0]=u=>ve($).push("/interactive"))},"返回"),s[4]||(s[4]=t("h1",null,"数字绘画系统",-1))]),t("div",ye,[t("div",_e,[t("button",{onClick:N,title:"撤销",disabled:v.value<=0},"↩️",8,ke),t("button",{onClick:q,title:"重做",disabled:v.value>=i.value.length-1},"↪️",8,Ce),t("button",{onClick:G,title:"清除画布"},"🗑️"),t("button",{onClick:j,title:"保存作品"},"💾"),t("button",{onClick:Z,class:"frame-button",title:"前往虚拟装裱"},"🖼️")])]),t("div",Fe,[t("canvas",{ref_key:"canvasRef",ref:l,class:"drawing-canvas",onPointerdown:ee,onPointermove:te,onPointerup:z,onPointerout:z,onPointercancel:z,onMousemove:P,onMouseenter:ae,onMouseleave:le,"touch-action":"none",style:{cursor:"none","-webkit-touch-callout":"none","-webkit-user-select":"none","user-select":"none"}},null,544),M.value&&H.value?(d(),c("div",{key:0,class:"custom-cursor",style:D({left:`${b.value}px`,top:`${w.value}px`})},[t("span",{class:"cursor-icon",style:D({fontSize:`${Math.max(18,n.value*1.5)}px`,filter:h.value?"drop-shadow(0 0 3px rgba(0,0,0,0.5))":"drop-shadow(0 0 1px white)",transform:h.value?"scale(0.9) rotate(-15deg)":"scale(1) rotate(0deg)",color:r.value.id==="eraser"?"red":m.value})},F(r.value.icon),5),r.value.id!=="eraser"?(d(),c("div",{key:0,class:"cursor-brush-preview",style:D({width:`${n.value}px`,height:`${n.value}px`,backgroundColor:m.value,opacity:g.value*.3,transform:h.value?"scale(0.8)":"scale(1)"})},null,4)):(d(),c("div",{key:1,class:"cursor-eraser-preview",style:D({width:`${n.value}px`,height:`${n.value}px`,border:"1px dashed red",backgroundColor:"rgba(255, 255, 255, 0.2)",transform:h.value?"scale(0.8)":"scale(1)"})},null,4))],4)):C("",!0)]),t("div",xe,[t("div",De,[ce(he,{name:"slide-fade"},{default:de(()=>[k.value?(d(),c("div",Me,[t("div",Se,[s[5]||(s[5]=t("label",null,"大小",-1)),R(t("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=u=>n.value=u),min:"1",max:"50",step:"1"},null,512),[[I,n.value]])]),t("div",ze,[s[6]||(s[6]=t("label",null,"透明度",-1)),R(t("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=u=>g.value=u),min:"0.1",max:"1",step:"0.1"},null,512),[[I,g.value]])])])):C("",!0)]),_:1}),t("div",{class:T(["brush-tools",{"brush-tools-with-settings":k.value}])},[(d(!0),c(pe,null,ge(B.value,u=>(d(),c("button",{key:u.id,onClick:X=>O(u),class:T({active:r.value.id===u.id}),title:u.name},[t("span",Te,F(u.icon),1)],10,Pe))),128))],2)])]),x.value?(d(),c("div",Re,[t("div",Ie,[s[8]||(s[8]=t("h3",null,"保存我的作品",-1)),t("div",$e,[s[7]||(s[7]=t("label",{for:"artwork-title"},"作品标题",-1)),R(t("input",{type:"text",id:"artwork-title","onUpdate:modelValue":s[3]||(s[3]=u=>f.value=u),placeholder:"请输入作品标题",maxlength:"30"},null,512),[[I,f.value]])]),t("p",{class:T(["save-message",{error:!y.value&&p.value}])},F(p.value),3),t("div",{class:"dialog-buttons"},[t("button",{onClick:Q,class:"cancel-button"},"取消"),t("button",{onClick:K,class:"save-button"},"保存")])])])):C("",!0),y.value?(d(),c("div",Be,[t("p",null,F(p.value),1)])):C("",!0),Y.value?(d(),c("div",Ee,[t("p",null,F(W.value),1)])):C("",!0)]))}}),Ye=me(Xe,[["__scopeId","data-v-ee32230b"]]);export{Ye as default};
