import{d as oe,f as o,g as ue,C as ne,B as ie,i as c,j as t,k as C,x as ve,m as re,n as M,q as S,t as x,a as ce,w as de,T as he,F as pe,l as fe,p as $,E as B,o as d}from"./vendor-1Pylr8mE.js";import{s as ge}from"./userArtworkService-BWPUhC9p.js";import{_ as me}from"./index-OhZk9ZkP.js";const be={class:"digital-drawing-container"},we={class:"drawing-toolbar"},ye={class:"toolbar-actions-container"},ke={class:"toolbar-actions"},_e=["disabled"],Ce=["disabled"],xe={class:"drawing-area"},Fe={class:"tools-panel"},De={class:"tools-panel-inner"},Me={key:0,class:"brush-settings"},Se={class:"setting-item"},Te={class:"setting-item"},ze=["onClick","title"],Pe={class:"tool-icon"},Re={key:0,class:"save-dialog-overlay"},Ie={class:"save-dialog"},$e={class:"input-group"},Be={key:1,class:"save-success-toast"},Ee={key:2,class:"mobile-error-toast"},Ue=20,Ve=oe({__name:"DigitalDrawing",setup(Xe){const E=re(),l=o(null),e=o(null),h=o(!1),n=o(5),f=o(.8),m=o("#000000"),W=o(!0),b=o(0),w=o(0),Y=o(!0),T=o(!1),F=o(!1),g=o(""),y=o(!1),p=o(""),i=o([]),v=o(-1),D=o(!1),k=o({x:0,y:0}),_=o(!1),U=o([{id:"brush-pen",name:"毛笔",icon:"🖌️",size:8,opacity:.8,color:"#000000"},{id:"ink-pen",name:"钢笔",icon:"✒️",size:2,opacity:1,color:"#000000"},{id:"water-brush",name:"水彩",icon:"💧",size:15,opacity:.4,color:"#4285F4"},{id:"charcoal",name:"炭笔",icon:"✏️",size:6,opacity:.7,color:"#666666"},{id:"eraser",name:"橡皮擦",icon:"🧽",size:15,opacity:1,color:"#FFFFFF"}]),r=o(U.value[0]),V=o(""),z=o(!1);ue(()=>{if(l.value){const a=l.value.parentElement;a&&(l.value.width=a.clientWidth,l.value.height=a.clientHeight),e.value=l.value.getContext("2d",{willReadFrequently:!0}),e.value&&G(),A(),window.addEventListener("resize",X)}}),ne(()=>{window.removeEventListener("resize",X)});const X=()=>{if(l.value&&e.value){const a=l.value.parentElement;if(a){const s=e.value.getImageData(0,0,l.value.width,l.value.height);l.value.width=a.clientWidth,l.value.height=a.clientHeight,e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),e.value.putImageData(s,0,0),A()}}},A=()=>{D.value=window.innerWidth<=768},L=()=>{e.value&&(e.value.lineCap="round",e.value.lineJoin="round",r.value.id==="eraser"?(e.value.globalCompositeOperation="destination-out",e.value.lineWidth=n.value,e.value.globalAlpha=1):(e.value.globalCompositeOperation="source-over",e.value.strokeStyle=m.value,e.value.lineWidth=n.value,e.value.globalAlpha=f.value))},O=a=>{const s=r.value.id===a.id;r.value=a,n.value=a.size,f.value=a.opacity,m.value=a.color,s?_.value=!_.value:_.value=!0},P=()=>{if(e.value&&l.value){v.value<i.value.length-1&&(i.value=i.value.slice(0,v.value+1));const a=e.value.getImageData(0,0,l.value.width,l.value.height);i.value.push(a),i.value.length>Ue&&i.value.shift(),v.value=i.value.length-1}},q=()=>{v.value>0&&e.value&&l.value&&(v.value--,e.value.putImageData(i.value[v.value],0,0))},N=()=>{v.value<i.value.length-1&&e.value&&l.value&&(v.value++,e.value.putImageData(i.value[v.value],0,0))},j=()=>{e.value&&l.value&&(e.value.save(),e.value.globalCompositeOperation="source-over",e.value.globalAlpha=1,e.value.clearRect(0,0,l.value.width,l.value.height),e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),e.value.restore(),P())},G=()=>{e.value&&l.value&&(e.value.fillStyle="#FFFFFF",e.value.fillRect(0,0,l.value.width,l.value.height),P())},J=()=>{if(l.value){F.value=!0;const a=new Date;g.value=`我的作品 ${a.getMonth()+1}月${a.getDate()}日`}},K=()=>{if(l.value&&g.value.trim())try{const a=l.value.toDataURL("image/png");ge(g.value.trim(),a,0),y.value=!0,p.value="作品已保存！您可以在虚拟装裱中使用它。",setTimeout(()=>{y.value=!1,p.value=""},3e3),F.value=!1}catch(a){console.error("保存作品失败:",a),y.value=!1,p.value="保存失败，请重试。"}else g.value.trim()||(y.value=!1,p.value="请输入作品标题")},Q=()=>{F.value=!1,g.value="",p.value=""},Z=()=>{if(D.value){V.value="此功能手机端有BUG，待修复，您可尝试用电脑打开预览。",z.value=!0,setTimeout(()=>{z.value=!1},3e3);return}E.push("/frame")},ee=a=>{h.value=!0,l.value&&"setPointerCapture"in l.value&&l.value.setPointerCapture(a.pointerId),a.preventDefault(),I(a),k.value={x:b.value,y:w.value},e.value&&(e.value.beginPath(),e.value.moveTo(b.value,w.value))},R=a=>{h.value&&(h.value=!1,l.value&&"releasePointerCapture"in l.value&&l.value.releasePointerCapture(a.pointerId),e.value&&(e.value.beginPath(),P()))},I=a=>{if(!l.value)return;const s=l.value.getBoundingClientRect();"touches"in a&&a.touches.length>0?(b.value=a.touches[0].clientX-s.left,w.value=a.touches[0].clientY-s.top):"clientX"in a&&(b.value=a.clientX-s.left,w.value=a.clientY-s.top)},ae=()=>{T.value=!0},le=()=>{h.value||(T.value=!1)},te=a=>{if(!h.value||!e.value||!l.value)return;a.preventDefault(),I(a);const s=b.value,u=w.value;if(L(),W.value&&"pressure"in a&&a.pressure!==0&&(e.value.lineWidth=n.value*(.5+a.pressure*1.5)),e.value){e.value.beginPath(),e.value.moveTo(k.value.x,k.value.y);const H=(k.value.x+s)/2,se=(k.value.y+u)/2;e.value.quadraticCurveTo(H,se,s,u),e.value.stroke(),k.value={x:s,y:u}}};return ie([n,m,f],()=>{r.value&&(r.value.size=n.value,r.value.opacity=f.value,r.value.color=m.value)}),(a,s)=>(d(),c("div",be,[t("div",we,[t("button",{class:"back-button",onClick:s[0]||(s[0]=u=>ve(E).push("/interactive"))},"返回"),s[4]||(s[4]=t("h1",null,"数字绘画系统",-1))]),t("div",ye,[t("div",ke,[t("button",{onClick:q,title:"撤销",disabled:v.value<=0},"↩️",8,_e),t("button",{onClick:N,title:"重做",disabled:v.value>=i.value.length-1},"↪️",8,Ce),t("button",{onClick:j,title:"清除画布"},"🗑️"),t("button",{onClick:J,title:"保存作品"},"💾"),t("button",{onClick:Z,class:M({"frame-button":!D.value,"frame-button-mobile-disabled":D.value}),title:"前往虚拟装裱"},"🖼️",2)])]),t("div",xe,[t("canvas",{ref_key:"canvasRef",ref:l,class:"drawing-canvas",onPointerdown:ee,onPointermove:te,onPointerup:R,onPointerout:R,onPointercancel:R,onMousemove:I,onMouseenter:ae,onMouseleave:le,"touch-action":"none",style:{cursor:"none","-webkit-touch-callout":"none","-webkit-user-select":"none","user-select":"none"}},null,544),T.value&&Y.value?(d(),c("div",{key:0,class:"custom-cursor",style:S({left:`${b.value}px`,top:`${w.value}px`})},[t("span",{class:"cursor-icon",style:S({fontSize:`${Math.max(18,n.value*1.5)}px`,filter:h.value?"drop-shadow(0 0 3px rgba(0,0,0,0.5))":"drop-shadow(0 0 1px white)",transform:h.value?"scale(0.9) rotate(-15deg)":"scale(1) rotate(0deg)",color:r.value.id==="eraser"?"red":m.value})},x(r.value.icon),5),r.value.id!=="eraser"?(d(),c("div",{key:0,class:"cursor-brush-preview",style:S({width:`${n.value}px`,height:`${n.value}px`,backgroundColor:m.value,opacity:f.value*.3,transform:h.value?"scale(0.8)":"scale(1)"})},null,4)):(d(),c("div",{key:1,class:"cursor-eraser-preview",style:S({width:`${n.value}px`,height:`${n.value}px`,border:"1px dashed red",backgroundColor:"rgba(255, 255, 255, 0.2)",transform:h.value?"scale(0.8)":"scale(1)"})},null,4))],4)):C("",!0)]),t("div",Fe,[t("div",De,[ce(he,{name:"slide-fade"},{default:de(()=>[_.value?(d(),c("div",Me,[t("div",Se,[s[5]||(s[5]=t("label",null,"大小",-1)),$(t("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=u=>n.value=u),min:"1",max:"50",step:"1"},null,512),[[B,n.value]])]),t("div",Te,[s[6]||(s[6]=t("label",null,"透明度",-1)),$(t("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=u=>f.value=u),min:"0.1",max:"1",step:"0.1"},null,512),[[B,f.value]])])])):C("",!0)]),_:1}),t("div",{class:M(["brush-tools",{"brush-tools-with-settings":_.value}])},[(d(!0),c(pe,null,fe(U.value,u=>(d(),c("button",{key:u.id,onClick:H=>O(u),class:M({active:r.value.id===u.id}),title:u.name},[t("span",Pe,x(u.icon),1)],10,ze))),128))],2)])]),F.value?(d(),c("div",Re,[t("div",Ie,[s[8]||(s[8]=t("h3",null,"保存我的作品",-1)),t("div",$e,[s[7]||(s[7]=t("label",{for:"artwork-title"},"作品标题",-1)),$(t("input",{type:"text",id:"artwork-title","onUpdate:modelValue":s[3]||(s[3]=u=>g.value=u),placeholder:"请输入作品标题",maxlength:"30"},null,512),[[B,g.value]])]),t("p",{class:M(["save-message",{error:!y.value&&p.value}])},x(p.value),3),t("div",{class:"dialog-buttons"},[t("button",{onClick:Q,class:"cancel-button"},"取消"),t("button",{onClick:K,class:"save-button"},"保存")])])])):C("",!0),y.value?(d(),c("div",Be,[t("p",null,x(p.value),1)])):C("",!0),z.value?(d(),c("div",Ee,[t("p",null,x(V.value),1)])):C("",!0)]))}}),Ye=me(Ve,[["__scopeId","data-v-d699f80d"]]);export{Ye as default};
