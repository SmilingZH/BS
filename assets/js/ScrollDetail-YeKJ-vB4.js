import{d as Q,r as P,C as X,g as ge,D as me,c as $,a as N,b as t,o as O,t as k,n as fe,k as ce,q as he,u as De,e as le,m as de}from"./vendor-B5ERtXls.js";import{S as $e,C as j,P as Oe,W as Le,a as xe,A as Ee,D as Re,b as Se,c as _e,d as pe,M as Z,G as Ue,e as Ae,f as Te,R as Ne,V as ze,T as We,g as ve,h as ae,_ as ee,i as K,j as Ye,s as T}from"./index-4XJbkE_t.js";import{O as Ve,g as y}from"./index-jsv5-ZvU.js";import{m as se}from"./art-detail-info-CC9r1Tz1.js";var H=(I=>(I.LOADING="loading",I.READY="ready",I.UNROLLED="unrolled",I.ROLLED="rolled",I.ERROR="error",I))(H||{});const Be={key:0,class:"loading-indicator"},ie=.05,B=2,He=Q({__name:"ScrollViewer",props:{imageUrl:{},scale:{default:1},backgroundColor:{default:"#f5e6d3"},rodColor:{default:"#4a3728"},autoUnroll:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},emits:["imageLoaded","unrolled","rolled","error"],setup(I,{expose:W,emit:U}){const c=I,b=U,l=P(null),C=P(!1),s=P(!1),d=P(!1),D=P(H.LOADING);let g=null,a=null,i=null,o=null,v=null,p=null,h=null,w=null;const F=ie*1.5,J=F,M=P(1.5);let E=!1,A=0,z={x:0,y:0};X(()=>c.imageUrl,async(e,n)=>{if(e!==n){console.log(`图片URL已更改: ${n} -> ${e}`),d.value=!0;const r=s.value;console.log(`切换图片前卷轴状态: ${r?"已展开":"已收起"}`),s.value&&(console.log("重置前收起卷轴，防止尺寸异常"),s.value=!1,p&&h&&w&&v&&(y.to(p.scale,{y:1,duration:.5,ease:"power2.inOut"}),y.to(h.position,{y:F/2,duration:.5,ease:"power2.inOut"}),y.to(w.position,{y:-.07500000000000001/2,duration:.5,ease:"power2.inOut"}),v&&y.to(v.rotation,{x:Math.PI*.1,duration:.5,ease:"power2.inOut"}))),C.value=!1,await new Promise(u=>setTimeout(u,100)),await be(),r&&(console.log("准备展开新卷轴，等待图片加载完成..."),await new Promise(u=>{const f=()=>{C.value?(console.log("图片已加载完成，可以展开卷轴"),u()):(console.log("图片尚未加载完成，继续等待..."),setTimeout(f,100))};f()}),console.log("开始展开新卷轴"),setTimeout(()=>{s.value?console.log("卷轴已经是展开状态，无需再次展开"):(console.log("执行卷轴展开动画"),V())},300))}},{immediate:!1}),X(()=>c.scale,e=>{console.log("卷轴缩放已变更:",e),v&&(v.scale.set(e,e,e),G())},{immediate:!1}),X(()=>c.backgroundColor,e=>{console.log("背景颜色已变更:",e),g&&(g.background=new j(e))},{immediate:!1}),X(()=>c.rodColor,e=>{if(console.log("卷轴杆颜色已变更:",e),h&&w){const n=new ae({color:new j(e),roughness:.8,metalness:.2});h.material=n,w.material=n}},{immediate:!1});const G=()=>{if(!v||!p||!h||!w)return;const e=B/M.value,n=q(e);y.to(v.position,{y:n,duration:.3,ease:"power1.out"}),a&&o&&y.to(o.target,{y:n,duration:.3,ease:"power1.out",onUpdate:function(){o&&o.update()}})},Y=()=>{!a||!o||(c.isMobile||window.innerWidth<=768?(a.position.set(5,6.5,6),o.target.set(0,2,0)):(a.position.set(5,4.5,5),o.target.set(0,.5,0)),o.update())},L=()=>{if(!v||!a||!o)return;const e=M.value;if(e>2){const n=Math.min(2,(e-2)*.5+.5);y.to(v.position,{y:v.position.y+n,duration:.5,ease:"power2.out"}),y.to(o.target,{y:o.target.y+n,duration:.5,ease:"power2.out",onUpdate:function(){o==null||o.update()}})}},S=async()=>{if(!l.value)return null;g=new $e,g.background=new j(c.backgroundColor);const e=l.value.clientWidth,n=l.value.clientHeight;a=new Oe(75,e/n,.1,1e3),c.isMobile||window.innerWidth<=768?a.position.set(5,6.5,6):a.position.set(5,4.5,5),a.lookAt(0,0,0),i=new Le({antialias:!0}),i.setSize(e,n),i.shadowMap.enabled=!0,i.shadowMap.type=xe,l.value.appendChild(i.domElement);const r=new Ee(16777215,.5);g.add(r);const u=new Re(16777215,1);u.position.set(5,5,5),u.castShadow=!0,g.add(u),we(),o=new Ve(a,i.domElement),o.enableDamping=!0,o.dampingFactor=.05,o.enablePan=!0,o.addEventListener("change",()=>{o&&(o.target.y=Math.max(-1,o.target.y))}),c.isMobile||window.innerWidth<=768?(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2.5,o.maxDistance=15,o.target.set(0,2,0)):(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2,o.maxDistance=12,o.target.set(0,.5,0)),o.autoRotate=!1,o.autoRotateSpeed=1,o.enableZoom=!0,o.zoomSpeed=1,o.update(),a.userData.controls=o;try{console.log("初始化：开始创建卷轴"),await re().then(()=>{console.log("初始化：卷轴创建成功"),C.value=!0,c.scale!==1&&v&&(console.log(`初始化：应用初始缩放系数 ${c.scale}`),G()),b("imageLoaded"),c.autoUnroll&&!s.value&&(console.log("初始化：配置为自动展开，准备展开卷轴"),setTimeout(()=>{s.value?console.log("初始化：卷轴已经展开，无需再次展开"):(console.log("初始化：执行自动展开"),V())},300))})}catch(R){console.error("初始化创建卷轴失败:",R),b("error","初始化创建卷轴失败")}const f=Pe();l.value.addEventListener("click",ue);const x=()=>{!i||!g||!a||(requestAnimationFrame(x),o&&o.update(),i.render(g,a))};x();const m=()=>{if(!a||!i||!l.value)return;const R=l.value.clientWidth,_=l.value.clientHeight;a.aspect=R/_,a.updateProjectionMatrix(),i.setSize(R,_),window.innerWidth<=768&&a&&o&&(a.position.set(5,6.5,6),o.target.set(0,2,0))};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),l.value&&i&&(l.value.removeEventListener("click",ue),l.value.removeChild(i.domElement)),f&&f(),g&&g.clear(),i&&i.dispose(),g=null,a=null,i=null,o=null}},we=()=>{if(!g)return;const e=5,n=64,r=new Se(e,n),u=new _e({uniforms:{centerColor:{value:new j(13421772)},edgeColor:{value:new j(16777215)},radius:{value:e}},vertexShader:`
      varying vec2 vPosition;
      
      void main() {
        vPosition = position.xy;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 centerColor;
      uniform vec3 edgeColor;
      uniform float radius;
      
      varying vec2 vPosition;
      
      void main() {
        float dist = length(vPosition) / radius;
        float alpha = 1.0 - smoothstep(0.0, 1.0, dist);
        vec3 color = mix(edgeColor, centerColor, 1.0 - dist);
        gl_FragColor = vec4(color, alpha);
      }
    `,transparent:!0,side:pe}),f=new Z(r,u);f.rotation.x=-Math.PI/2,f.receiveShadow=!0,g.add(f)},ye=()=>{const e=new We;return new Promise((n,r)=>{if(!c.imageUrl){console.error("未提供图片URL"),b("error","未提供图片URL"),r(new Error("未提供图片URL"));return}C.value=!1,console.log(`开始加载新图片: ${c.imageUrl}`),e.load(c.imageUrl,u=>{if(console.log("图片加载成功"),C.value=!0,d.value=!1,b("imageLoaded"),u.image){const m=u.image.width,R=u.image.height,_=m/R;M.value=_,console.log(`图片尺寸: ${m}x${R}, 宽高比: ${_.toFixed(2)}`),Ie(_)}u.wrapS=ve,u.wrapT=ve,u.repeat.set(1,1),u.rotation=Math.PI,u.center.set(.5,.5);const f=new ae({map:u,side:pe,roughness:.7,metalness:.1}),x=new ae({color:new j(c.rodColor),roughness:.8,metalness:.2});n({paperMaterial:f,rodMaterial:x}),c.autoUnroll&&!d.value&&setTimeout(()=>{s.value||(console.log("自动展开卷轴 (初始加载)"),Ce())},300)},u=>{console.log(`图片加载进度: ${Math.round(u.loaded/u.total*100)}%`)},u=>{const f=u instanceof Error?u.message:"未知错误";console.error("图片加载失败:",u),b("error",`图片加载失败: ${f}`),r(u)})})},Ie=e=>{let n="标准",r=.2;e<.5?(n="超宽矮图",r=.5):e<.8?(n="较宽矮图",r=.35):e>2?(n="超高窄图",r=.3):e>1.5?(n="较高窄图",r=.25):e>=.8&&e<=1.2&&(n="接近正方形",r=.2),console.log(`图片类型: ${n}, 基础安全边距: ${r.toFixed(2)}`)},re=async()=>{if(!g)return null;const e=new Ue;v=e;const n=await ye(),{paperMaterial:r,rodMaterial:u}=n,f=B/M.value;let x=Math.min(f,5);M.value<.3&&(x=Math.max(x,.8),console.log(`超宽图片调整: 增加最小展开高度到 ${x.toFixed(2)}`));const m=q(f);console.log(`计算的卷轴中心位置: ${m.toFixed(2)}`);const R=new Ae(B,J,20,20);p=new Z(R,r),p.rotation.z=Math.PI,p.rotation.y=Math.PI;const _=new Te(ie,ie,B+.2,16);if(h=new Z(_,u),h.position.y=F/2,h.rotation.z=Math.PI/2,w=new Z(_.clone(),u),w.position.y=-.07500000000000001/2,w.rotation.z=Math.PI/2,e.add(p),e.add(h),e.add(w),e.position.set(0,m,0),e.rotation.x=Math.PI*.1,e.scale.set(c.scale,c.scale,c.scale),g.add(e),a&&o){if(c.isMobile||window.innerWidth<=768?o.target.set(0,m+.5,0):o.target.set(0,m,0),m>2){const ne=a.position.clone(),ke=c.isMobile||window.innerWidth<=768?4:3;a.position.set(ne.x,m+ke,ne.z),a.updateProjectionMatrix()}o.update()}return Me(e),e},ue=e=>{if(E||!C.value||!g||!a)return;console.log("处理点击事件");const n=e.target.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,u=-((e.clientY-n.top)/n.height)*2+1,f=new Ne;f.setFromCamera(new ze(r,u),a),v&&f.intersectObjects(v.children,!0).length>0&&(console.log("点击到卷轴，切换展开/收起状态"),s.value?oe():V())};let V=()=>{},oe=()=>{};const Ce=()=>V?(V(),!0):!1;W({unroll:V,roll:oe,resetView:()=>{if(!a||!o)return;const e=c.isMobile||window.innerWidth<=768?{x:5,y:6.5,z:6}:{x:5,y:4.5,z:5},n=c.isMobile||window.innerWidth<=768?{x:0,y:2,z:0}:{x:0,y:.5,z:0};y.to(a.position,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power2.inOut"}),y.to(o.target,{x:n.x,y:n.y,z:n.z,duration:1,ease:"power2.inOut",onUpdate:function(){o&&o.update()}})},getState:()=>({isLoaded:C.value,isUnrolled:s.value,scrollState:D.value,error:D.value===H.ERROR})}),X(C,e=>{e?D.value=H.READY:D.value=H.LOADING}),X(s,e=>{e?(D.value=H.UNROLLED,b("unrolled")):C.value&&(D.value=H.ROLLED,b("rolled"))});let te=null;ge(async()=>{te=await S()}),me(()=>{te&&te()});const be=async()=>{if(!(!g||!a||!l.value)){console.log("开始重置卷轴..."),v&&(g.remove(v),v=null,p=null,h=null,w=null,console.log("已移除旧卷轴"));try{console.log("开始创建新卷轴");const e=await re();if(e){v=e,g.add(v),console.log("新卷轴已添加到场景"),Y();const n=B/M.value;let r=q(n);return console.log(`计算的卷轴中心Y位置: ${r}`),v&&(v.position.y=r,console.log(`已设置卷轴位置Y: ${r}`),o&&(o.target.set(0,r,0),o.update(),console.log("已更新相机目标点")),setTimeout(L,100)),console.log("卷轴重置完成"),!0}else return console.error("创建卷轴失败: 返回null"),!1}catch(e){return console.error("重置卷轴失败:",e),b("error",`重置卷轴失败: ${e.message||"未知错误"}`),!1}}},q=e=>{let n=Math.min(e,5);M.value<.3&&(n=Math.max(n,.8));let r=c.isMobile?3:2.2;M.value>1.5&&(r+=(M.value-1.5)*.8),M.value>2.5&&(r+=.8),M.value>3.5&&(r+=(M.value-3.5)*.4);const u=Math.max(.2,n*.15);return r+=u,r*=c.scale,r},Me=e=>{V=()=>{if(console.log("开始展开卷轴动画..."),!p){console.error("展开失败: paperMesh不存在");return}if(!h){console.error("展开失败: topRod不存在");return}if(!w){console.error("展开失败: bottomRod不存在");return}if(s.value){console.log("卷轴已经是展开状态，无需再次展开");return}const n=B/M.value;console.log(`展开尺寸: ${n}, 宽高比: ${M.value}`);let r=Math.min(n,5);M.value<.3&&(r=Math.max(r,.8),console.log(`超宽图片调整: 最终展开高度为 ${r}`));const u=r+.1;console.log(`展开动画开始：卷轴杆距离: ${u}`),y.to(p.scale,{y:r/J,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("纸张展开动画开始"),onComplete:()=>console.log("纸张展开动画完成")}),y.to(h.position,{y:u/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("上杆移动动画开始"),onComplete:()=>console.log("上杆移动动画完成")}),y.to(w.position,{y:-u/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("下杆移动动画开始"),onComplete:()=>console.log("下杆移动动画完成")}),y.to(e.rotation,{x:0,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("卷轴旋转动画开始"),onComplete:()=>{console.log("卷轴旋转动画完成，标记为展开状态"),s.value=!0;const f=B/M.value;let x=q(f);console.log(`展开后计算的中心Y位置: ${x}`),y.to(e.position,{y:x,duration:.5,ease:"power2.out",onStart:()=>console.log("展开后位置调整开始"),onComplete:()=>{console.log("展开后位置调整完成"),L()}}),a&&o&&y.to(o.target,{y:x,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()},onComplete:()=>console.log("相机目标点调整完成")}),c.scale!==1&&(console.log(`应用缩放系数: ${c.scale}`),G()),b("unrolled")}})},oe=()=>{!p||!h||!w||!s.value||(y.to(p.scale,{y:1,duration:1.5,ease:"power2.inOut"}),y.to(h.position,{y:F/2,duration:1.5,ease:"power2.inOut"}),y.to(w.position,{y:-.07500000000000001/2,duration:1.5,ease:"power2.inOut"}),y.to(e.rotation,{x:Math.PI*.1,duration:1.5,ease:"power2.inOut",onComplete:()=>{s.value=!1;const n=q(J);y.to(e.position,{y:n,duration:.5,ease:"power2.out"}),a&&o&&y.to(o.target,{y:n,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()}}),c.scale!==1&&G()}}))}},Pe=()=>{if(!l.value)return;const e=m=>{E=!1,A=Date.now(),z={x:m.clientX,y:m.clientY}},n=m=>{if(!E&&A>0){const R=Math.abs(m.clientX-z.x),_=Math.abs(m.clientY-z.y);(R>5||_>5)&&(E=!0)}},r=()=>{Date.now()-A<200&&!E&&(E=!1),setTimeout(()=>{A=0},10)},u=m=>{m.touches.length===1&&(E=!1,A=Date.now(),z={x:m.touches[0].clientX,y:m.touches[0].clientY})},f=m=>{if(!E&&A>0&&m.touches.length===1){const R=Math.abs(m.touches[0].clientX-z.x),_=Math.abs(m.touches[0].clientY-z.y);(R>10||_>10)&&(E=!0)}},x=()=>{Date.now()-A<300&&!E&&(E=!1),setTimeout(()=>{A=0},10)};return l.value.addEventListener("mousedown",e),l.value.addEventListener("mousemove",n),l.value.addEventListener("mouseup",r),l.value.addEventListener("touchstart",u),l.value.addEventListener("touchmove",f),l.value.addEventListener("touchend",x),()=>{l.value&&(l.value.removeEventListener("mousedown",e),l.value.removeEventListener("mousemove",n),l.value.removeEventListener("mouseup",r),l.value.removeEventListener("touchstart",u),l.value.removeEventListener("touchmove",f),l.value.removeEventListener("touchend",x))}};return(e,n)=>(O(),$("div",{ref_key:"containerRef",ref:l,class:"scroll-viewer-container"},[C.value?N("",!0):(O(),$("div",Be,n[0]||(n[0]=[t("div",{class:"loading-spinner"},null,-1),t("div",{class:"loading-text"},"加载中...",-1)])))],512))}}),Fe=ee(He,[["__scopeId","data-v-2dd3a979"]]),Ge={class:"scroll-control-wrapper"},Xe={class:"operation-tips"},je={key:0,class:"tips-section"},Je={key:1,class:"tips-section"},qe={class:"control-group"},Ze={class:"control-group"},Ke={class:"image-counter"},Qe={class:"control-group"},eo=["value"],oo={class:"color-controls"},to={class:"control-group color-group"},no=["value"],lo={class:"control-group color-group"},ao=["value"],so=Q({__name:"ScrollControlPanel",props:{isOpen:{type:Boolean},scale:{},backgroundColor:{},rodColor:{},currentImageIndex:{},totalImages:{},isMobile:{type:Boolean}},emits:["update:isOpen","update:scale","update:backgroundColor","update:rodColor","prevImage","nextImage","openInfoPanel","resetView"],setup(I,{emit:W}){const U=I,c=W,b=s=>{const d=s.target;c("update:scale",Number(d.value))},l=()=>{c("update:isOpen",!U.isOpen)},C=()=>{c("openInfoPanel")};return(s,d)=>(O(),$("div",Ge,[t("div",{class:fe(["control-panel",{open:s.isOpen}])},[t("div",{class:"panel-close-btn",onClick:l},"✕"),s.isMobile?(O(),$("div",{key:0,class:"info-panel-btn",onClick:C},"ℹ️")):N("",!0),d[10]||(d[10]=t("h3",null,"卷轴控制面板",-1)),t("div",Xe,[s.isMobile?(O(),$("div",Je,d[6]||(d[6]=[t("h4",null,"操作提示",-1),t("ul",null,[t("li",null,"点击卷轴可展开/收起卷轴"),t("li",null,"滑动屏幕可旋转视角"),t("li",null,"两只手指操控可缩放视角/移动卷轴")],-1)]))):(O(),$("div",je,d[5]||(d[5]=[t("h4",null,"操作提示",-1),t("ul",null,[t("li",null,"点击卷轴可展开/收起卷轴"),t("li",null,"左键单击滑动屏幕可旋转视角"),t("li",null,"右键单击滑动屏幕可移动卷轴"),t("li",null,"滑动滚轮可缩放视角")],-1)])))]),t("div",qe,[t("button",{onClick:d[0]||(d[0]=D=>s.$emit("resetView")),class:"reset-view-btn"},"重置视图")]),t("div",Ze,[t("button",{onClick:d[1]||(d[1]=D=>s.$emit("prevImage"))},"上一张"),t("button",{onClick:d[2]||(d[2]=D=>s.$emit("nextImage"))},"下一张"),t("div",Ke,"图片 "+k(s.currentImageIndex+1)+"/"+k(s.totalImages),1)]),t("div",Qe,[d[7]||(d[7]=t("label",null,"卷轴大小:",-1)),t("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:s.scale,onChange:b},null,40,eo),t("span",null,k(s.scale),1)]),t("div",oo,[t("div",to,[d[8]||(d[8]=t("label",null,"背景颜色:",-1)),t("input",{type:"color",value:s.backgroundColor,onChange:d[3]||(d[3]=D=>s.$emit("update:backgroundColor",D.target.value))},null,40,no)]),t("div",lo,[d[9]||(d[9]=t("label",null,"卷轴杆颜色:",-1)),t("input",{type:"color",value:s.rodColor,onChange:d[4]||(d[4]=D=>s.$emit("update:rodColor",D.target.value))},null,40,ao)])])],2),t("div",{class:"control-panel-toggle",onClick:l},[t("span",null,k(s.isOpen?"✕":"⚙️"),1)])]))}}),io=ee(so,[["__scopeId","data-v-adbc5d65"]]),ro={class:"basic-info-wrapper"},uo={class:"panel-header"},co={key:0,class:"info-content"},po={class:"artwork-info"},vo={class:"artwork-title"},go={class:"artwork-creator"},mo={class:"artwork-artist"},fo={class:"artwork-dynasty"},ho={class:"artwork-year"},wo={class:"artwork-details"},yo={class:"artwork-detail-item"},Io={class:"value"},Co={class:"artwork-detail-item"},bo={class:"value"},Mo={class:"artwork-description"},Po={key:0,class:"artwork-significance"},ko={key:1,class:"mobile-nav-buttons"},Do={class:"image-counter"},$o={key:1,class:"no-info"},Oo=Q({__name:"BasicInfoPanel",props:{isOpen:{type:Boolean,default:!1},currentImageIndex:{type:Number,default:0},totalImages:{type:Number,default:0},isMobile:{type:Boolean,default:!1},isControlPanelOpen:{type:Boolean,default:!1}},emits:["update:isOpen","prevImage","nextImage","openControlPanel"],setup(I,{emit:W}){const U=he(),c=I,b=W,l=ce(()=>K(c.currentImageIndex)),C=()=>{b("update:isOpen",!c.isOpen)},s=()=>{b("update:isOpen",!1)},d=()=>{b("openControlPanel")},D=ce(()=>!(c.isMobile&&c.isControlPanelOpen)),g=()=>{const a=Ye(c.currentImageIndex);if(a){console.log("找到画作信息:",a),sessionStorage.setItem("masterpieceReferrer",window.location.pathname);const i=a.id;console.log("当前画作ID:",i);const o=se.find(v=>v.id===i);if(o)console.log("找到详情信息，跳转到:",o.id),U.push(`/masterpiece/${o.id}`);else{console.log("未找到详情信息，尝试查找相似作品");const v=se.find(p=>p.title===a.title&&p.artist===a.artist);if(v)console.log("找到相似作品，跳转到:",v.id),U.push(`/masterpiece/${v.id}`);else{const p=i.replace(/^0+/,""),h=se.find(w=>w.id===p);h?(console.log("使用无前导零ID找到详情，跳转到:",h.id),U.push(`/masterpiece/${h.id}`)):(console.log("未找到相似作品，尝试直接使用ID跳转:",i),U.push(`/masterpiece/${i}`))}}}else console.warn("未找到当前画作信息"),alert("抱歉，无法获取当前画作信息")};return(a,i)=>(O(),$("div",ro,[t("div",{class:fe(["info-panel",{open:I.isOpen,mobile:I.isMobile}])},[t("div",uo,[t("div",{class:"panel-close-btn",onClick:s},"✕"),I.isMobile?(O(),$("div",{key:0,class:"control-panel-btn",onClick:d},"⚙️")):N("",!0),I.isMobile?(O(),$("div",{key:1,class:"detail-btn",onClick:g},"详细")):N("",!0),i[2]||(i[2]=t("h3",null,"画作基本信息",-1))]),l.value?(O(),$("div",co,[t("div",po,[t("h2",vo,k(l.value.title),1),I.isMobile?N("",!0):(O(),$("div",{key:0,class:"pc-detail-btn",onClick:g},"查看详细介绍")),t("div",go,[t("span",mo,k(l.value.artist),1),t("span",fo,k(l.value.dynasty),1),t("span",ho,k(l.value.year),1)]),t("div",wo,[t("div",yo,[i[3]||(i[3]=t("span",{class:"label"},"尺寸:",-1)),t("span",Io,k(l.value.dimensions),1)]),t("div",Co,[i[4]||(i[4]=t("span",{class:"label"},"收藏地:",-1)),t("span",bo,k(l.value.collection),1)])]),t("p",Mo,k(l.value.description),1)]),l.value.significance?(O(),$("div",Po,[i[5]||(i[5]=t("h3",null,"艺术价值和历史意义",-1)),t("p",null,k(l.value.significance),1)])):N("",!0),I.isMobile?(O(),$("div",ko,[t("button",{onClick:i[0]||(i[0]=o=>a.$emit("prevImage"))},"上一张"),t("button",{onClick:i[1]||(i[1]=o=>a.$emit("nextImage"))},"下一张"),t("div",Do,"图片 "+k(I.currentImageIndex+1)+"/"+k(I.totalImages),1)])):N("",!0)])):(O(),$("div",$o,i[6]||(i[6]=[t("p",null,"暂无图片信息",-1)])))],2),D.value?(O(),$("div",{key:0,class:"info-panel-toggle",onClick:C},i[7]||(i[7]=[t("span",null,"ℹ️",-1)]))):N("",!0)]))}}),Lo=ee(Oo,[["__scopeId","data-v-5dfa9bf6"]]),xo={class:"scroll-detail-container"},Eo=Q({__name:"ScrollDetail",setup(I){const W=De(),U=he(),c=P(Number(W.params.id||0)),b=P(null),l=P(!1),C=P(""),s=P("返回画廊");ge(()=>{d(),window.addEventListener("resize",d),D()}),me(()=>{window.removeEventListener("resize",d)});const d=()=>{l.value=window.innerWidth<=768},D=()=>{const Y=sessionStorage.getItem("scrollReferrer"),L=document.referrer,S=L?new URL(L).pathname:"";C.value=Y||S,C.value.includes("/gallery")||Y==="gallery"?s.value="返回画廊":C.value==="/"||C.value.includes("/home")||Y==="home"?s.value="返回主页":C.value.includes("/masterpiece")||Y==="masterpiece"?s.value="返回作品":(s.value="返回画廊",sessionStorage.setItem("scrollReferrer","gallery")),console.log("用户来源:",C.value,"按钮文本:",s.value)},g=P(!1),a=P(!0),i=P(1),o=P("#f5e6d3"),v=P("#4a3728"),p=P(Math.min(c.value,T.length-1)),h=P(T[p.value]),w=P(K(p.value)),F=()=>{s.value==="返回主页"?U.push("/"):s.value==="返回作品"?U.go(-1):U.push("/gallery")},J=()=>{console.log(`图片加载完成: ${p.value+1}/${T.length}`)},M=()=>{p.value=(p.value+1)%T.length,h.value=T[p.value],w.value=K(p.value),history.replaceState(null,"",`/scroll/${p.value}`)},E=()=>{p.value=(p.value-1+T.length)%T.length,h.value=T[p.value],w.value=K(p.value),history.replaceState(null,"",`/scroll/${p.value}`)},A=()=>{a.value=!0,l.value&&(g.value=!1)},z=()=>{g.value=!0,l.value&&(a.value=!1)},G=()=>{b.value&&b.value.resetView()};return(Y,L)=>(O(),$("div",xo,[t("button",{class:"back-button",onClick:F},k(s.value),1),le(Fe,{ref_key:"scrollViewerRef",ref:b,imageUrl:h.value,scale:i.value,backgroundColor:o.value,rodColor:v.value,autoUnroll:!0,isMobile:l.value,onImageLoaded:J,class:"scroll-viewer"},null,8,["imageUrl","scale","backgroundColor","rodColor","isMobile"]),a.value?N("",!0):(O(),$("div",{key:0,class:"scroll-title",onClick:A},[t("h1",null,k(w.value.title),1),t("p",null,k(w.value.artist)+" · "+k(w.value.dynasty),1)])),le(io,{isOpen:g.value,scale:i.value,backgroundColor:o.value,rodColor:v.value,currentImageIndex:p.value,totalImages:de(T).length,isMobile:l.value,"onUpdate:isOpen":L[0]||(L[0]=S=>g.value=S),"onUpdate:scale":L[1]||(L[1]=S=>i.value=S),"onUpdate:backgroundColor":L[2]||(L[2]=S=>o.value=S),"onUpdate:rodColor":L[3]||(L[3]=S=>v.value=S),onNextImage:M,onPrevImage:E,onOpenInfoPanel:A,onResetView:G},null,8,["isOpen","scale","backgroundColor","rodColor","currentImageIndex","totalImages","isMobile"]),le(Lo,{isOpen:a.value,currentImageIndex:p.value,totalImages:de(T).length,isMobile:l.value,isControlPanelOpen:g.value,"onUpdate:isOpen":L[4]||(L[4]=S=>a.value=S),onPrevImage:E,onNextImage:M,onOpenControlPanel:z},null,8,["isOpen","currentImageIndex","totalImages","isMobile","isControlPanelOpen"])]))}}),No=ee(Eo,[["__scopeId","data-v-ece393fc"]]);export{No as default};
