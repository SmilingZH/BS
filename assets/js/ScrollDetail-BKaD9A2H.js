import{d as ee,r as P,C as X,g as fe,D as he,c as L,a as z,b as t,o as E,t as $,n as we,k as ve,q as ye,u as $e,e as se,m as pe}from"./vendor-B5ERtXls.js";import{S as De,C as j,P as Oe,W as Le,a as Ee,A as xe,D as Re,b as Se,c as _e,d as ge,M as K,G as Ue,e as Ae,f as Te,R as Ne,V as ze,T as We,g as me,h as ie,_ as oe,i as Q,j as Ye,s as T}from"./index-BRBySVmZ.js";import{O as Ve,g as I}from"./index-YTxZgVdi.js";import{m as re}from"./art-detail-info-DgScSf78.js";var F=(C=>(C.LOADING="loading",C.READY="ready",C.UNROLLED="unrolled",C.ROLLED="rolled",C.ERROR="error",C))(F||{});const Be={key:0,class:"loading-indicator"},ue=.05,H=2,He=ee({__name:"ScrollViewer",props:{imageUrl:{},scale:{default:1},backgroundColor:{default:"#f5e6d3"},rodColor:{default:"#4a3728"},autoUnroll:{type:Boolean,default:!1},isMobile:{type:Boolean,default:!1}},emits:["imageLoaded","unrolled","rolled","error"],setup(C,{expose:W,emit:U}){const c=C,h=U,l=P(null),b=P(!1),s=P(!1),d=P(!1),M=P(F.LOADING);let g=null,a=null,i=null,o=null,p=null,v=null,w=null,y=null;const G=ue*1.5,J=G,k=P(1.5);let R=!1,A=0,N={x:0,y:0};X(()=>c.imageUrl,async(e,n)=>{if(e!==n){console.log(`图片URL已更改: ${n} -> ${e}`),d.value=!0;const r=s.value;console.log(`切换图片前卷轴状态: ${r?"已展开":"已收起"}`),s.value&&(console.log("重置前收起卷轴，防止尺寸异常"),s.value=!1,v&&w&&y&&p&&(I.to(v.scale,{y:1,duration:.5,ease:"power2.inOut"}),I.to(w.position,{y:G/2,duration:.5,ease:"power2.inOut"}),I.to(y.position,{y:-.07500000000000001/2,duration:.5,ease:"power2.inOut"}),p&&I.to(p.rotation,{x:Math.PI*.1,duration:.5,ease:"power2.inOut"}))),b.value=!1,await new Promise(u=>setTimeout(u,100)),await be(),r&&(console.log("准备展开新卷轴，等待图片加载完成..."),await new Promise(u=>{const f=()=>{b.value?(console.log("图片已加载完成，可以展开卷轴"),u()):(console.log("图片尚未加载完成，继续等待..."),setTimeout(f,100))};f()}),console.log("开始展开新卷轴"),setTimeout(()=>{s.value?console.log("卷轴已经是展开状态，无需再次展开"):(console.log("执行卷轴展开动画"),B())},300))}},{immediate:!1}),X(()=>c.scale,e=>{console.log("卷轴缩放已变更:",e),p&&(p.scale.set(e,e,e),Y())},{immediate:!1}),X(()=>c.backgroundColor,e=>{console.log("背景颜色已变更:",e),g&&(g.background=new j(e))},{immediate:!1}),X(()=>c.rodColor,e=>{if(console.log("卷轴杆颜色已变更:",e),w&&y){const n=new ie({color:new j(e),roughness:.8,metalness:.2});w.material=n,y.material=n}},{immediate:!1});const Y=()=>{if(!p||!v||!w||!y)return;const e=H/k.value,n=q(e);I.to(p.position,{y:n,duration:.3,ease:"power1.out"}),a&&o&&I.to(o.target,{y:n,duration:.3,ease:"power1.out",onUpdate:function(){o&&o.update()}})},te=()=>{!a||!o||(c.isMobile||window.innerWidth<=768?(a.position.set(5,6.5,6),o.target.set(0,2,0)):(a.position.set(5,4.5,5),o.target.set(0,.5,0)),o.update())},Z=()=>{if(!p||!a||!o)return;const e=k.value;if(e>2){const n=Math.min(2,(e-2)*.5+.5);I.to(p.position,{y:p.position.y+n,duration:.5,ease:"power2.out"}),I.to(o.target,{y:o.target.y+n,duration:.5,ease:"power2.out",onUpdate:function(){o==null||o.update()}})}},V=async()=>{if(!l.value)return null;g=new De,g.background=new j(c.backgroundColor);const e=l.value.clientWidth,n=l.value.clientHeight;a=new Oe(75,e/n,.1,1e3),c.isMobile||window.innerWidth<=768?a.position.set(5,6.5,6):a.position.set(5,4.5,5),a.lookAt(0,0,0),i=new Le({antialias:!0}),i.setSize(e,n),i.shadowMap.enabled=!0,i.shadowMap.type=Ee,l.value.appendChild(i.domElement);const r=new xe(16777215,.5);g.add(r);const u=new Re(16777215,1);u.position.set(5,5,5),u.castShadow=!0,g.add(u),O(),o=new Ve(a,i.domElement),o.enableDamping=!0,o.dampingFactor=.05,o.enablePan=!0,o.addEventListener("change",()=>{o&&(o.target.y=Math.max(-1,o.target.y))}),c.isMobile||window.innerWidth<=768?(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2.5,o.maxDistance=15,o.target.set(0,2,0)):(o.minPolarAngle=0,o.maxPolarAngle=Math.PI,o.minDistance=2,o.maxDistance=12,o.target.set(0,.5,0)),o.autoRotate=!1,o.autoRotateSpeed=1,o.enableZoom=!0,o.zoomSpeed=1,o.update(),a.userData.controls=o;try{console.log("初始化：开始创建卷轴"),await ce().then(()=>{console.log("初始化：卷轴创建成功"),b.value=!0,c.scale!==1&&p&&(console.log(`初始化：应用初始缩放系数 ${c.scale}`),Y()),h("imageLoaded"),c.autoUnroll&&!s.value&&(console.log("初始化：配置为自动展开，准备展开卷轴"),setTimeout(()=>{s.value?console.log("初始化：卷轴已经展开，无需再次展开"):(console.log("初始化：执行自动展开"),B())},300))})}catch(x){console.error("初始化创建卷轴失败:",x),h("error","初始化创建卷轴失败")}const f=Pe();l.value.addEventListener("click",de);const D=()=>{!i||!g||!a||(requestAnimationFrame(D),o&&o.update(),i.render(g,a))};D();const m=()=>{if(!a||!i||!l.value)return;const x=l.value.clientWidth,_=l.value.clientHeight;a.aspect=x/_,a.updateProjectionMatrix(),i.setSize(x,_),window.innerWidth<=768&&a&&o&&(a.position.set(5,6.5,6),o.target.set(0,2,0))};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),l.value&&i&&(l.value.removeEventListener("click",de),l.value.removeChild(i.domElement)),f&&f(),g&&g.clear(),i&&i.dispose(),g=null,a=null,i=null,o=null}},O=()=>{if(!g)return;const e=5,n=64,r=new Se(e,n),u=new _e({uniforms:{centerColor:{value:new j(13421772)},edgeColor:{value:new j(16777215)},radius:{value:e}},vertexShader:`
      varying vec2 vPosition;
      
      void main() {
        vPosition = position.xy;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 centerColor;
      uniform vec3 edgeColor;
      uniform float radius;
      
      varying vec2 vPosition;
      
      void main() {
        float dist = length(vPosition) / radius;
        float alpha = 1.0 - smoothstep(0.0, 1.0, dist);
        vec3 color = mix(edgeColor, centerColor, 1.0 - dist);
        gl_FragColor = vec4(color, alpha);
      }
    `,transparent:!0,side:ge}),f=new K(r,u);f.rotation.x=-Math.PI/2,f.receiveShadow=!0,g.add(f)},S=()=>{const e=new We;return new Promise((n,r)=>{if(!c.imageUrl){console.error("未提供图片URL"),h("error","未提供图片URL"),r(new Error("未提供图片URL"));return}b.value=!1,console.log(`开始加载新图片: ${c.imageUrl}`),e.load(c.imageUrl,u=>{if(console.log("图片加载成功"),b.value=!0,d.value=!1,h("imageLoaded"),u.image){const m=u.image.width,x=u.image.height,_=m/x;k.value=_,console.log(`图片尺寸: ${m}x${x}, 宽高比: ${_.toFixed(2)}`),Ie(_)}u.wrapS=me,u.wrapT=me,u.repeat.set(1,1),u.rotation=Math.PI,u.center.set(.5,.5);const f=new ie({map:u,side:ge,roughness:.7,metalness:.1}),D=new ie({color:new j(c.rodColor),roughness:.8,metalness:.2});n({paperMaterial:f,rodMaterial:D}),c.autoUnroll&&!d.value&&setTimeout(()=>{s.value||(console.log("自动展开卷轴 (初始加载)"),Ce())},300)},u=>{console.log(`图片加载进度: ${Math.round(u.loaded/u.total*100)}%`)},u=>{const f=u instanceof Error?u.message:"未知错误";console.error("图片加载失败:",u),h("error",`图片加载失败: ${f}`),r(u)})})},Ie=e=>{let n="标准",r=.2;e<.5?(n="超宽矮图",r=.5):e<.8?(n="较宽矮图",r=.35):e>2?(n="超高窄图",r=.3):e>1.5?(n="较高窄图",r=.25):e>=.8&&e<=1.2&&(n="接近正方形",r=.2),console.log(`图片类型: ${n}, 基础安全边距: ${r.toFixed(2)}`)},ce=async()=>{if(!g)return null;const e=new Ue;p=e;const n=await S(),{paperMaterial:r,rodMaterial:u}=n,f=H/k.value;let D=Math.min(f,5);k.value<.3&&(D=Math.max(D,.8),console.log(`超宽图片调整: 增加最小展开高度到 ${D.toFixed(2)}`));const m=q(f);console.log(`计算的卷轴中心位置: ${m.toFixed(2)}`);const x=new Ae(H,J,20,20);v=new K(x,r),v.rotation.z=Math.PI,v.rotation.y=Math.PI;const _=new Te(ue,ue,H+.2,16);if(w=new K(_,u),w.position.y=G/2,w.rotation.z=Math.PI/2,y=new K(_.clone(),u),y.position.y=-.07500000000000001/2,y.rotation.z=Math.PI/2,e.add(v),e.add(w),e.add(y),e.position.set(0,m,0),e.rotation.x=Math.PI*.1,e.scale.set(c.scale,c.scale,c.scale),g.add(e),a&&o){if(c.isMobile||window.innerWidth<=768?o.target.set(0,m+.5,0):o.target.set(0,m,0),m>2){const ae=a.position.clone(),ke=c.isMobile||window.innerWidth<=768?4:3;a.position.set(ae.x,m+ke,ae.z),a.updateProjectionMatrix()}o.update()}return Me(e),e},de=e=>{if(R||!b.value||!g||!a)return;console.log("处理点击事件");const n=e.target.getBoundingClientRect(),r=(e.clientX-n.left)/n.width*2-1,u=-((e.clientY-n.top)/n.height)*2+1,f=new Ne;f.setFromCamera(new ze(r,u),a),p&&f.intersectObjects(p.children,!0).length>0&&(console.log("点击到卷轴，切换展开/收起状态"),s.value?ne():B())};let B=()=>{},ne=()=>{};const Ce=()=>B?(B(),!0):!1;W({unroll:B,roll:ne,resetView:()=>{if(!a||!o)return;const e=c.isMobile||window.innerWidth<=768?{x:5,y:6.5,z:6}:{x:5,y:4.5,z:5},n=c.isMobile||window.innerWidth<=768?{x:0,y:2,z:0}:{x:0,y:.5,z:0};I.to(a.position,{x:e.x,y:e.y,z:e.z,duration:1,ease:"power2.inOut"}),I.to(o.target,{x:n.x,y:n.y,z:n.z,duration:1,ease:"power2.inOut",onUpdate:function(){o&&o.update()}})},getState:()=>({isLoaded:b.value,isUnrolled:s.value,scrollState:M.value,error:M.value===F.ERROR})}),X(b,e=>{e?M.value=F.READY:M.value=F.LOADING}),X(s,e=>{e?(M.value=F.UNROLLED,h("unrolled")):b.value&&(M.value=F.ROLLED,h("rolled"))});let le=null;fe(async()=>{le=await V()}),he(()=>{le&&le()});const be=async()=>{if(!(!g||!a||!l.value)){console.log("开始重置卷轴..."),p&&(g.remove(p),p=null,v=null,w=null,y=null,console.log("已移除旧卷轴"));try{console.log("开始创建新卷轴");const e=await ce();if(e){p=e,g.add(p),console.log("新卷轴已添加到场景"),te();const n=H/k.value;let r=q(n);return console.log(`计算的卷轴中心Y位置: ${r}`),p&&(p.position.y=r,console.log(`已设置卷轴位置Y: ${r}`),o&&(o.target.set(0,r,0),o.update(),console.log("已更新相机目标点")),setTimeout(Z,100)),console.log("卷轴重置完成"),!0}else return console.error("创建卷轴失败: 返回null"),!1}catch(e){return console.error("重置卷轴失败:",e),h("error",`重置卷轴失败: ${e.message||"未知错误"}`),!1}}},q=e=>{let n=Math.min(e,5);k.value<.3&&(n=Math.max(n,.8));let r=c.isMobile?3:2.2;k.value>1.5&&(r+=(k.value-1.5)*.8),k.value>2.5&&(r+=.8),k.value>3.5&&(r+=(k.value-3.5)*.4);const u=Math.max(.2,n*.15);return r+=u,r*=c.scale,r},Me=e=>{B=()=>{if(console.log("开始展开卷轴动画..."),!v){console.error("展开失败: paperMesh不存在");return}if(!w){console.error("展开失败: topRod不存在");return}if(!y){console.error("展开失败: bottomRod不存在");return}if(s.value){console.log("卷轴已经是展开状态，无需再次展开");return}const n=H/k.value;console.log(`展开尺寸: ${n}, 宽高比: ${k.value}`);let r=Math.min(n,5);k.value<.3&&(r=Math.max(r,.8),console.log(`超宽图片调整: 最终展开高度为 ${r}`));const u=r+.1;console.log(`展开动画开始：卷轴杆距离: ${u}`),I.to(v.scale,{y:r/J,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("纸张展开动画开始"),onComplete:()=>console.log("纸张展开动画完成")}),I.to(w.position,{y:u/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("上杆移动动画开始"),onComplete:()=>console.log("上杆移动动画完成")}),I.to(y.position,{y:-u/2,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("下杆移动动画开始"),onComplete:()=>console.log("下杆移动动画完成")}),I.to(e.rotation,{x:0,duration:1.5,ease:"power2.inOut",onStart:()=>console.log("卷轴旋转动画开始"),onComplete:()=>{console.log("卷轴旋转动画完成，标记为展开状态"),s.value=!0;const f=H/k.value;let D=q(f);console.log(`展开后计算的中心Y位置: ${D}`),I.to(e.position,{y:D,duration:.5,ease:"power2.out",onStart:()=>console.log("展开后位置调整开始"),onComplete:()=>{console.log("展开后位置调整完成"),Z()}}),a&&o&&I.to(o.target,{y:D,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()},onComplete:()=>console.log("相机目标点调整完成")}),c.scale!==1&&(console.log(`应用缩放系数: ${c.scale}`),Y()),h("unrolled")}})},ne=()=>{!v||!w||!y||!s.value||(I.to(v.scale,{y:1,duration:1.5,ease:"power2.inOut"}),I.to(w.position,{y:G/2,duration:1.5,ease:"power2.inOut"}),I.to(y.position,{y:-.07500000000000001/2,duration:1.5,ease:"power2.inOut"}),I.to(e.rotation,{x:Math.PI*.1,duration:1.5,ease:"power2.inOut",onComplete:()=>{s.value=!1;const n=q(J);I.to(e.position,{y:n,duration:.5,ease:"power2.out"}),a&&o&&I.to(o.target,{y:n,duration:.5,ease:"power2.out",onUpdate:function(){o&&o.update()}}),c.scale!==1&&Y()}}))}},Pe=()=>{if(!l.value)return;const e=m=>{R=!1,A=Date.now(),N={x:m.clientX,y:m.clientY}},n=m=>{if(!R&&A>0){const x=Math.abs(m.clientX-N.x),_=Math.abs(m.clientY-N.y);(x>5||_>5)&&(R=!0)}},r=()=>{Date.now()-A<200&&!R&&(R=!1),setTimeout(()=>{A=0},10)},u=m=>{m.touches.length===1&&(R=!1,A=Date.now(),N={x:m.touches[0].clientX,y:m.touches[0].clientY})},f=m=>{if(!R&&A>0&&m.touches.length===1){const x=Math.abs(m.touches[0].clientX-N.x),_=Math.abs(m.touches[0].clientY-N.y);(x>10||_>10)&&(R=!0)}},D=()=>{Date.now()-A<300&&!R&&(R=!1),setTimeout(()=>{A=0},10)};return l.value.addEventListener("mousedown",e),l.value.addEventListener("mousemove",n),l.value.addEventListener("mouseup",r),l.value.addEventListener("touchstart",u),l.value.addEventListener("touchmove",f),l.value.addEventListener("touchend",D),()=>{l.value&&(l.value.removeEventListener("mousedown",e),l.value.removeEventListener("mousemove",n),l.value.removeEventListener("mouseup",r),l.value.removeEventListener("touchstart",u),l.value.removeEventListener("touchmove",f),l.value.removeEventListener("touchend",D))}};return(e,n)=>(E(),L("div",{ref_key:"containerRef",ref:l,class:"scroll-viewer-container"},[b.value?z("",!0):(E(),L("div",Be,n[0]||(n[0]=[t("div",{class:"loading-spinner"},null,-1),t("div",{class:"loading-text"},"加载中...",-1)])))],512))}}),Fe=oe(He,[["__scopeId","data-v-2dd3a979"]]),Ge={class:"scroll-control-wrapper"},Xe={class:"control-group"},je={class:"control-group"},Je={class:"control-group"},qe={class:"image-counter"},Ze={class:"control-group"},Ke=["value"],Qe={class:"color-controls"},eo={class:"control-group color-group"},oo=["value"],to={class:"control-group color-group"},no=["value"],lo=ee({__name:"ScrollControlPanel",props:{isOpen:{type:Boolean},scale:{},backgroundColor:{},rodColor:{},currentImageIndex:{},totalImages:{},isMobile:{type:Boolean}},emits:["update:isOpen","update:scale","update:backgroundColor","update:rodColor","unroll","roll","prevImage","nextImage","openInfoPanel","resetView"],setup(C,{emit:W}){const U=C,c=W,h=s=>{const d=s.target;c("update:scale",Number(d.value))},l=()=>{c("update:isOpen",!U.isOpen)},b=()=>{c("openInfoPanel")};return(s,d)=>(E(),L("div",Ge,[t("div",{class:we(["control-panel",{open:s.isOpen}])},[t("div",{class:"panel-close-btn",onClick:l},"✕"),s.isMobile?(E(),L("div",{key:0,class:"info-panel-btn",onClick:b},"ℹ️")):z("",!0),d[10]||(d[10]=t("h3",null,"卷轴控制面板",-1)),t("div",Xe,[t("button",{onClick:d[0]||(d[0]=M=>s.$emit("unroll"))},"展开卷轴"),t("button",{onClick:d[1]||(d[1]=M=>s.$emit("roll"))},"收起卷轴")]),t("div",je,[t("button",{onClick:d[2]||(d[2]=M=>s.$emit("resetView")),class:"reset-view-btn"},"重置视图")]),t("div",Je,[t("button",{onClick:d[3]||(d[3]=M=>s.$emit("prevImage"))},"上一张"),t("button",{onClick:d[4]||(d[4]=M=>s.$emit("nextImage"))},"下一张"),t("div",qe,"图片 "+$(s.currentImageIndex+1)+"/"+$(s.totalImages),1)]),t("div",Ze,[d[7]||(d[7]=t("label",null,"卷轴大小:",-1)),t("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:s.scale,onChange:h},null,40,Ke),t("span",null,$(s.scale),1)]),t("div",Qe,[t("div",eo,[d[8]||(d[8]=t("label",null,"背景颜色:",-1)),t("input",{type:"color",value:s.backgroundColor,onChange:d[5]||(d[5]=M=>s.$emit("update:backgroundColor",M.target.value))},null,40,oo)]),t("div",to,[d[9]||(d[9]=t("label",null,"卷轴杆颜色:",-1)),t("input",{type:"color",value:s.rodColor,onChange:d[6]||(d[6]=M=>s.$emit("update:rodColor",M.target.value))},null,40,no)])])],2),t("div",{class:"control-panel-toggle",onClick:l},[t("span",null,$(s.isOpen?"✕":"⚙️"),1)])]))}}),ao=oe(lo,[["__scopeId","data-v-56a7609e"]]),so={class:"basic-info-wrapper"},io={class:"panel-header"},ro={key:0,class:"info-content"},uo={class:"artwork-info"},co={class:"artwork-title"},vo={class:"artwork-creator"},po={class:"artwork-artist"},go={class:"artwork-dynasty"},mo={class:"artwork-year"},fo={class:"artwork-details"},ho={class:"artwork-detail-item"},wo={class:"value"},yo={class:"artwork-detail-item"},Io={class:"value"},Co={class:"artwork-description"},bo={key:0,class:"artwork-significance"},Mo={key:1,class:"mobile-nav-buttons"},Po={class:"image-counter"},ko={key:1,class:"no-info"},$o=ee({__name:"BasicInfoPanel",props:{isOpen:{type:Boolean,default:!1},currentImageIndex:{type:Number,default:0},totalImages:{type:Number,default:0},isMobile:{type:Boolean,default:!1},isControlPanelOpen:{type:Boolean,default:!1}},emits:["update:isOpen","prevImage","nextImage","openControlPanel"],setup(C,{emit:W}){const U=ye(),c=C,h=W,l=ve(()=>Q(c.currentImageIndex)),b=()=>{h("update:isOpen",!c.isOpen)},s=()=>{h("update:isOpen",!1)},d=()=>{h("openControlPanel")},M=ve(()=>!(c.isMobile&&c.isControlPanelOpen)),g=()=>{const a=Ye(c.currentImageIndex);if(a){console.log("找到画作信息:",a),sessionStorage.setItem("masterpieceReferrer",window.location.pathname);const i=a.id;console.log("当前画作ID:",i);const o=re.find(p=>p.id===i);if(o)console.log("找到详情信息，跳转到:",o.id),U.push(`/masterpiece/${o.id}`);else{console.log("未找到详情信息，尝试查找相似作品");const p=re.find(v=>v.title===a.title&&v.artist===a.artist);if(p)console.log("找到相似作品，跳转到:",p.id),U.push(`/masterpiece/${p.id}`);else{const v=i.replace(/^0+/,""),w=re.find(y=>y.id===v);w?(console.log("使用无前导零ID找到详情，跳转到:",w.id),U.push(`/masterpiece/${w.id}`)):(console.log("未找到相似作品，尝试直接使用ID跳转:",i),U.push(`/masterpiece/${i}`))}}}else console.warn("未找到当前画作信息"),alert("抱歉，无法获取当前画作信息")};return(a,i)=>(E(),L("div",so,[t("div",{class:we(["info-panel",{open:C.isOpen,mobile:C.isMobile}])},[t("div",io,[t("div",{class:"panel-close-btn",onClick:s},"✕"),C.isMobile?(E(),L("div",{key:0,class:"control-panel-btn",onClick:d},"⚙️")):z("",!0),C.isMobile?(E(),L("div",{key:1,class:"detail-btn",onClick:g},"详细")):z("",!0),i[2]||(i[2]=t("h3",null,"画作基本信息",-1))]),l.value?(E(),L("div",ro,[t("div",uo,[t("h2",co,$(l.value.title),1),C.isMobile?z("",!0):(E(),L("div",{key:0,class:"pc-detail-btn",onClick:g},"查看详细介绍")),t("div",vo,[t("span",po,$(l.value.artist),1),t("span",go,$(l.value.dynasty),1),t("span",mo,$(l.value.year),1)]),t("div",fo,[t("div",ho,[i[3]||(i[3]=t("span",{class:"label"},"尺寸:",-1)),t("span",wo,$(l.value.dimensions),1)]),t("div",yo,[i[4]||(i[4]=t("span",{class:"label"},"收藏地:",-1)),t("span",Io,$(l.value.collection),1)])]),t("p",Co,$(l.value.description),1)]),l.value.significance?(E(),L("div",bo,[i[5]||(i[5]=t("h3",null,"艺术价值和历史意义",-1)),t("p",null,$(l.value.significance),1)])):z("",!0),C.isMobile?(E(),L("div",Mo,[t("button",{onClick:i[0]||(i[0]=o=>a.$emit("prevImage"))},"上一张"),t("button",{onClick:i[1]||(i[1]=o=>a.$emit("nextImage"))},"下一张"),t("div",Po,"图片 "+$(C.currentImageIndex+1)+"/"+$(C.totalImages),1)])):z("",!0)])):(E(),L("div",ko,i[6]||(i[6]=[t("p",null,"暂无图片信息",-1)])))],2),M.value?(E(),L("div",{key:0,class:"info-panel-toggle",onClick:b},i[7]||(i[7]=[t("span",null,"ℹ️",-1)]))):z("",!0)]))}}),Do=oe($o,[["__scopeId","data-v-5dfa9bf6"]]),Oo={class:"scroll-detail-container"},Lo=ee({__name:"ScrollDetail",setup(C){const W=$e(),U=ye(),c=P(Number(W.params.id||0)),h=P(null),l=P(!1),b=P(""),s=P("返回画廊");fe(()=>{d(),window.addEventListener("resize",d),M()}),he(()=>{window.removeEventListener("resize",d)});const d=()=>{l.value=window.innerWidth<=768},M=()=>{const V=sessionStorage.getItem("scrollReferrer"),O=document.referrer,S=O?new URL(O).pathname:"";b.value=V||S,b.value.includes("/gallery")||V==="gallery"?s.value="返回画廊":b.value==="/"||b.value.includes("/home")||V==="home"?s.value="返回主页":b.value.includes("/masterpiece")||V==="masterpiece"?s.value="返回作品":(s.value="返回画廊",sessionStorage.setItem("scrollReferrer","gallery")),console.log("用户来源:",b.value,"按钮文本:",s.value)},g=P(!1),a=P(!0),i=P(1),o=P("#f5e6d3"),p=P("#4a3728"),v=P(Math.min(c.value,T.length-1)),w=P(T[v.value]),y=P(Q(v.value)),G=()=>{s.value==="返回主页"?U.push("/"):s.value==="返回作品"?U.go(-1):U.push("/gallery")},J=()=>{h.value&&h.value.unroll()},k=()=>{h.value&&h.value.roll()},R=()=>{console.log(`图片加载完成: ${v.value+1}/${T.length}`)},A=()=>{v.value=(v.value+1)%T.length,w.value=T[v.value],y.value=Q(v.value),history.replaceState(null,"",`/scroll/${v.value}`)},N=()=>{v.value=(v.value-1+T.length)%T.length,w.value=T[v.value],y.value=Q(v.value),history.replaceState(null,"",`/scroll/${v.value}`)},Y=()=>{a.value=!0,l.value&&(g.value=!1)},te=()=>{g.value=!0,l.value&&(a.value=!1)},Z=()=>{h.value&&h.value.resetView()};return(V,O)=>(E(),L("div",Oo,[t("button",{class:"back-button",onClick:G},$(s.value),1),se(Fe,{ref_key:"scrollViewerRef",ref:h,imageUrl:w.value,scale:i.value,backgroundColor:o.value,rodColor:p.value,autoUnroll:!0,isMobile:l.value,onImageLoaded:R,class:"scroll-viewer"},null,8,["imageUrl","scale","backgroundColor","rodColor","isMobile"]),a.value?z("",!0):(E(),L("div",{key:0,class:"scroll-title",onClick:Y},[t("h1",null,$(y.value.title),1),t("p",null,$(y.value.artist)+" · "+$(y.value.dynasty),1)])),se(ao,{isOpen:g.value,scale:i.value,backgroundColor:o.value,rodColor:p.value,currentImageIndex:v.value,totalImages:pe(T).length,isMobile:l.value,"onUpdate:isOpen":O[0]||(O[0]=S=>g.value=S),"onUpdate:scale":O[1]||(O[1]=S=>i.value=S),"onUpdate:backgroundColor":O[2]||(O[2]=S=>o.value=S),"onUpdate:rodColor":O[3]||(O[3]=S=>p.value=S),onUnroll:J,onRoll:k,onNextImage:A,onPrevImage:N,onOpenInfoPanel:Y,onResetView:Z},null,8,["isOpen","scale","backgroundColor","rodColor","currentImageIndex","totalImages","isMobile"]),se(Do,{isOpen:a.value,currentImageIndex:v.value,totalImages:pe(T).length,isMobile:l.value,isControlPanelOpen:g.value,"onUpdate:isOpen":O[4]||(O[4]=S=>a.value=S),onPrevImage:N,onNextImage:A,onOpenControlPanel:te},null,8,["isOpen","currentImageIndex","totalImages","isMobile","isControlPanelOpen"])]))}}),Ao=oe(Lo,[["__scopeId","data-v-b0c231f2"]]);export{Ao as default};
